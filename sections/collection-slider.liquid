{{ 'section-collection-slider.css' | asset_url | stylesheet_tag }}

{% assign section_id = section.id %}
{% assign heading = section.settings.heading %}
{% assign heading_animation = section.settings.heading_animation %}
{% assign description = section.settings.description %}
{% assign description_animation = section.settings.description_animation %}
{% assign collection = section.settings.collection %}
{% assign button_label = section.settings.button_label %}
{% assign animate_products = section.settings.animate_products %}
{% assign product_limit = section.settings.products_to_show | default: 10 %}

<div class="collection-slider" id="section-{{ section_id }}">
  <div class="collection-slider__container">
    <div class="collection-slider__content">
      {% if heading != blank %}
        <h2 class="heading--2xl collection-slider__heading {% if heading_animation != 'none' %}{{ heading_animation }}{% endif %}">
          {{ heading }}
        </h2>
      {% endif %}

      {% if description != blank %}
        <p class="body collection-slider__description {% if description_animation != 'none' %}{{ description_animation }}{% endif %}">
          {{ description }}
        </p>
      {% endif %}

      {% if collection != blank and button_label != blank %}
        {% assign collection_url = collection.url %}
        <a href="{{ collection_url }}" class="body collection-slider__link">
          {{ button_label }}
          {% render '_icon-arrow-submit-dark' %}
        </a>
      {% endif %}
    </div>

    {% if collection != blank %}
      {% assign collection_products = collection.products %}
      <div class="collection-slider__slider-wrapper">
        <div class="collection-slider__slider splide">
          <div class="splide__arrows">
            <button class="splide__arrow splide__arrow--prev">{% render '_icon-arrow-see-less' %}</button>
            <button class="splide__arrow splide__arrow--next">{% render '_icon-arrow-see-more' %}</button>
          </div>
          <div class="splide__track">
            <div class="splide__list {% if animate_products %}animate-container-cards-scroll{% endif %}">
              {% for product in collection_products limit: product_limit %}
                {% assign product_url = product.url %}
                {% assign product_title = product.title %}
                {% assign featured_image = product.featured_image %}
                {% assign featured_image_alt = product.featured_image.alt %}
                {% assign fabric_description = product.metafields.custom.fabric_description %}
                {% assign product_compare_price = product.compare_at_price %}
                {% assign product_price = product.price %}
                {% assign colour_variants_metafield = product.metafields.custom.product_colour_variants %}
                {% assign colour_swatch = product.metafields.custom.swatch_colour.value.colour | strip %}

                <article class="splide__slide collection-slider__slide">
                  <a href="{{ product.url }}" class="collection-slider__product-link">
                    <div class="collection-slider__product-image-wrapper">
                      {% if featured_image != blank %}
                        {{
                          featured_image
                          | image_url: width: 625
                          | image_tag:
                            class: 'collection-slider__product-image',
                            sizes: '(max-width: 625px) 400px, 625px',
                            loading: 'lazy',
                            decoding: 'async',
                            alt: featured_image_alt
                        }}
                      {% endif %}
                    </div>

                    <h3 class="body--bold collection-slider__product-title">{{ product_title }}</h3>

                    {% if fabric_description != blank %}
                      <p class="small collection-slider__product-material">
                        {{ fabric_description }}
                      </p>
                    {% endif %}

                    <p class="small collection-slider__product-price">
                      {% if product_compare_price > product_price %}
                        <span>
                          {{- product_price | money_with_currency -}}
                        </span>
                        <span class="collection-slider__product-price--compare">
                          {{- product_compare_price | money_with_currency -}}
                        </span>
                      {% else %}
                        {{ product_price | money_with_currency }}
                      {% endif %}
                    </p>
                  </a>

                  {% if colour_variants_metafield %}
                    {% assign colour_variants = colour_variants_metafield.value %}
                    {% assign max_display = 3 %}
                    {% assign remaining_count = colour_variants.count | minus: max_display %}

                    <div class="product-card__swatches">
                      {% assign bg_colour = colour_swatch | default: 'var(--neutral-200)' %}
                      {% assign border_style = '1px solid var(--neutral-950)' %}

                      <a
                        href="{{ product_url }}"
                        class="product-card__swatch-link"
                        aria-label="View {{ product_title }} variant"
                        style="border: {{ border_style }}; background-color: {{ bg_colour }}; padding: 2px; background-clip: content-box;"
                      >
                      </a>

                      {% for variant in colour_variants limit: max_display %}
                        {% assign variant_url = variant.url %}
                        {% assign variant_title = variant.title %}
                        {% assign variant_colour = variant.metafields.custom.swatch_colour.value.colour | strip %}
                        {% assign variant_name = variant.metafields.custom.swatch_colour.value.name | strip %}
                        {% assign bg_colour = variant_colour | default: 'var(--neutral-200)' %}

                        {% if variant_name == 'White' %}
                          {% assign border_style = '2px solid var(--neutral-200)' %}
                        {% else %}
                          {% assign border_colour = variant_colour | default: 'var(--neutral-950)' %}
                          {% assign border_style = '2px solid ' | append: border_colour %}
                        {% endif %}

                        <a
                          href="{{ variant_url }}"
                          class="product-card__swatch-link"
                          aria-label="View {{ variant_title }} variant"
                          style="border: {{ border_style }}; background-color: {{ bg_colour }};"
                        >
                        </a>
                      {% endfor %}

                      {% if remaining_count > 0 %}
                        <p class="small">+{{ remaining_count }}</p>
                      {% endif %}
                    </div>
                  {% endif %}
                </article>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    {% endif %}
  </div>
</div>

<script
  src="{{ "section-collection-slider.js" | asset_url }}"
  data-section-id="{{ section_id }}"
  defer
></script>

{% schema %}
{
  "name": "Collection Slider",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "New In Now"
    },
    {
      "type": "select",
      "id": "heading_animation",
      "label": "Heading Animation",
      "options": [
        {
          "value": "none",
          "label": "None"
        },
        {
          "value": "animate-word-slide-up-scroll",
          "label": "Slide Up Words"
        },
        {
          "value": "animate-word-rotate-scroll",
          "label": "Rotate In Words"
        },
        {
          "value": "animate-paragraph-slide-up-scroll",
          "label": "Slide Up"
        }
      ],
      "default": "none"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Layer up with premium wool/cashmere blends."
    },
    {
      "type": "select",
      "id": "description_animation",
      "label": "Description Animation",
      "options": [
        {
          "value": "none",
          "label": "None"
        },
        {
          "value": "animate-word-slide-up-scroll",
          "label": "Slide Up Words"
        },
        {
          "value": "animate-word-rotate-scroll",
          "label": "Rotate In Words"
        },
        {
          "value": "animate-paragraph-slide-up-scroll",
          "label": "Slide Up"
        }
      ],
      "default": "none"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button label",
      "default": "Shop Now"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 3,
      "max": 12,
      "step": 1,
      "default": 10,
      "label": "Maximum products to show"
    },
    {
      "type": "header",
      "content": "Animation Settings"
    },
    {
      "type": "checkbox",
      "id": "animate_products",
      "label": "Animate Products",
      "default": false,
      "info": "Adds a staggered animation to products as they scroll into view"
    }
  ],
  "presets": [
    {
      "name": "Collection Slider",
      "category": "Collection"
    }
  ],
  "enabled_on": {
    "templates": ["index", "page", "article", "blog"]
  }
}
{% endschema %}
