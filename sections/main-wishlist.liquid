{% comment %}
  Customer Wishlist - Displays all of the customer's wishlisted items
{% endcomment %}

{{ "section-main-wishlist.css" | asset_url | stylesheet_tag }}

{% assign wishlisted_products = customer.metafields.custom.wishlist.value %}
{% assign amount_in_wishlist = wishlisted_products | size %}

{% if customer == nil %}
  <!-- Shows when the customer is not signed in -->
  <div class="wishlist__state wishlist__state--unauthenticated">
    <p class="wishlist__state-title heading--decorative">Peter Jackson</p>
    <h1 class="wishlist__state-heading heading--3xl" data-title="Page not found">Your Wishlist</h1>
    <div class="wishlist__state-description">
      <p class="body">You must be logged in to manage your wishlist</p>
    </div>
    <p>
      <a href="{{ routes.account_login_url }}" class="wishlist__state-button button">Log In</a>
    </p>
  </div>

{% elsif amount_in_wishlist == 0 %}
  <!-- Shows when there are no products in the customer's wishlist -->
  <div class="wishlist__state wishlist__state--empty">
    <p class="wishlist__state-title heading--decorative">Peter Jackson</p>
    <h1 class="wishlist__state-heading heading--3xl" data-title="Page not found">Your Wishlist</h1>
    <div class="wishlist__state-description">
      <p class="body">There are no products in your wishlist</p>
    </div>
    <p>
      new arrivals
      <a href="{{ routes.account_login_url }}" class="wishlist__state-button button">Go to new arrivals</a>
    </p>
  </div>

{% else %}
  <!-- Shows when there are products in the wishlist -->
  <div class="wishlist__products-header">
    <h2 class="heading-l">Your Wishlist</h2>
  </div>
  <div class="wishlist__products">
    {% for current_product in wishlisted_products %}
{% comment %}
  Product Card - Integrated into Wishlist (BEM + current_product)
{% endcomment %}

{% assign image_width = image_width | default: 1000 %}
{% assign image_alt = current_product.featured_image.alt | escape | strip_html | strip_newlines | default: current_product.title %}
{% assign image_aspect_ratio = current_product.featured_image.aspect_ratio | default: 1 %}
{% assign image_height = image_width | divided_by: image_aspect_ratio | round %}

{% assign img_small = current_product.featured_image | image_url: width: 600 %}
{% assign img_large = current_product.featured_image | image_url: width: 1275 %}
{% assign img_height = 600 | divided_by: image_aspect_ratio | round %}

<div class="wishlist__product-card">
  <a class="wishlist__product-image-link" href="{{ current_product.url }}">
    <div class="wishlist__product-image-wrapper">
      <div style="background-color: var(--neutral-50); position: relative; width: 100%; padding-bottom: calc({{ image_height | times: 1.0 | divided_by: image_width | times: 100 }}%);">
        <img
          src="{{ img_small }}"
          width="600"
          height="{{ img_height }}"
          class="wishlist__product-image wishlist__product-image--first"
          loading="eager"
          decoding="async"
          alt="{{ image_alt }}"
          data-src-small="{{ img_small }}"
          data-src-large="{{ img_large }}"
          style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;"
        >

        {% if current_product.images.size > 1 %}
          {% assign img2_small = current_product.images[1] | image_url: width: 600 %}
          {% assign img2_large = current_product.images[1] | image_url: width: 1275 %}
          {% assign img2_aspect = current_product.images[1].aspect_ratio | default: 1 %}
          {% assign img2_height = 600 | divided_by: img2_aspect | round %}
          <img
            src="{{ img2_small }}"
            width="600"
            height="{{ img2_height }}"
            class="wishlist__product-image wishlist__product-image--second"
            loading="lazy"
            decoding="async"
            alt="{{ current_product.images[1].alt | escape | default: current_product.title }}"
            data-src-small="{{ img2_small }}"
            data-src-large="{{ img2_large }}"
            style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;"
          >
        {% endif %}

        {% if prominent_discount_mobile and current_product.metafields.custom.discount_bundle_name != blank %}
          {% if localization.market.handle == 'au' %}
            <p class="small wishlist__product-discount-code-prominent">
              {{ current_product.metafields.custom.discount_bundle_name | metafield_tag }}
            </p>
          {% endif %}
        {% endif %}
      </div>
    </div>
  </a>

  <div class="wishlist__product-content">
    <a href="{{ current_product.url }}" class="wishlist__product-title-link">
      <h2 class="wishlist__product-title body--bold">{{ current_product.title }}</h2>
    </a>

    {% if current_product.metafields.custom.fabric_description != blank %}
      <p class="wishlist__product-material small">
        {{ current_product.metafields.custom.fabric_description }}
      </p>
    {% endif %}

    <p class="wishlist__product-price small">
      <span class="wishlist__product-price--current">{{ current_product.price | money_with_currency }}</span>
      {% if current_product.compare_at_price > current_product.price %}
        <span class="wishlist__product-price--compare">Was {{ current_product.compare_at_price | money_with_currency }}</span>
      {% endif %}
      {% if current_product.metafields.custom.discount_bundle_name != blank %}
        {% unless prominent_discount_mobile %}
          {% if localization.market.handle == 'au' %}
            <span class="wishlist__product-discount-code-desktop">
              {{ current_product.metafields.custom.discount_bundle_name | metafield_tag }}
            </span>
          {% endif %}
        {% endunless %}
      {% endif %}
    </p>

    {% if current_product.metafields.custom.discount_bundle_name != blank %}
      {% unless prominent_discount_mobile %}
        {% if localization.market.handle == 'au' %}
          <p class="small wishlist__product-discount-code-mobile">
            {{ current_product.metafields.custom.discount_bundle_name | metafield_tag }}
          </p>
        {% endif %}
      {% endunless %}
    {% endif %}

    {% if current_product.metafields.custom.product_colour_variants %}
      {% assign colour_variants = current_product.metafields.custom.product_colour_variants.value %}
      {% assign max_display = 3 %}
      {% assign remaining_count = colour_variants.count | minus: max_display %}

      <div class="wishlist__product-swatches">
        {% assign current_colour = current_product.metafields.custom.swatch_colour.value.colour | strip %}
        {% assign bg_colour = current_colour | default: 'var(--neutral-200)' %}
        {% assign border_style = '1px solid var(--neutral-950)' %}

        <a
          href="{{ current_product.url }}"
          class="wishlist__product-swatch-link"
          aria-label="View {{ current_product.title }} variant"
          style="border: {{ border_style }}; background-color: {{ bg_colour }}; padding: 2px; background-clip: content-box;"
        >
        </a>

        {% for variant in colour_variants limit: max_display %}
          {% assign variant_colour = variant.metafields.custom.swatch_colour.value.colour | strip %}
          {% assign variant_name = variant.metafields.custom.swatch_colour.value.name | strip %}
          {% assign bg_colour = variant_colour | default: 'var(--neutral-200)' %}

          {% if variant_name == 'White' %}
            {% assign border_style = '2px solid var(--neutral-200)' %}
          {% else %}
            {% assign border_colour = variant_colour | default: 'var(--neutral-950)' %}
            {% assign border_style = '2px solid ' | append: border_colour %}
          {% endif %}

          <a
            href="{{ variant.url }}"
            class="wishlist__product-swatch-link"
            aria-label="View {{ variant.title }} variant"
            style="border: {{ border_style }}; background-color: {{ bg_colour }};"
          >
          </a>
        {% endfor %}

        {% if remaining_count > 0 %}
          <p class="small">+{{ remaining_count }}</p>
        {% endif %}
      </div>
    {% endif %}
  </div>
</div>

    {% endfor %}
  </div>
{% endif %}

{% schema %}
{
  "name": "Wishlist",
  "limit": 1,
  "tag": "section",
  "presets": [ { "name": "Wishlist" } ]
}
{% endschema %}