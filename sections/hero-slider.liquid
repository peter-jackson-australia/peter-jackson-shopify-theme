{{ 'section-hero-slider.css' | asset_url | stylesheet_tag }}

{% for block in section.blocks %}
  {% if block.settings.mobile_video %}
    <style>
      @media screen and (max-width: 768px) {
        #hero-slider-{{ section.id }} .splide__slide[data-block-id="{{ block.id }}"] .hero-slider__video--desktop {
          display: none;
        }
        #hero-slider-{{ section.id }} .splide__slide[data-block-id="{{ block.id }}"] .hero-slider__video--mobile {
          display: block;
        }
      }
    </style>
  {% endif %}
{% endfor %}

<div class="hero-slider splide" id="hero-slider-{{ section.id }}">
  <div class="splide__track">
    <ul class="splide__list">
      {% for block in section.blocks %}
        <li class="splide__slide" {{ block.shopify_attributes }} data-block-id="{{ block.id }}">
          {% if block.settings.media_type == 'image' %}
            {% if block.settings.desktop_image %}
              {% assign loading_attr = 'lazy' %}
              {% assign fetch_priority = 'low' %}
              {% if forloop.first %}
                {% assign loading_attr = 'eager' %}
                {% assign fetch_priority = 'high' %}
              {% endif %}

              <picture>
                {% if block.settings.mobile_image %}
                  <source
                    media="(max-width: 768px)"
                    srcset="{{ block.settings.mobile_image | image_url: width: 412 }} 1x"
                  >
                {% endif %}

                {{
                  block.settings.desktop_image
                  | image_url: width: block.settings.desktop_image.width
                  | image_tag:
                    class: 'hero-slider__background',
                    loading: loading_attr,
                    decoding: 'async',
                    fetchpriority: fetch_priority
                }}
              </picture>
            {% endif %}
          {% elsif block.settings.media_type == 'video' %}
            {% if block.settings.video %}
              <div class="hero-slider__video hero-slider__video--desktop">
                {% assign poster_url_desktop = block.settings.video_poster | image_url %}
                {{
                  block.settings.video
                  | video_tag:
                    autoplay: true,
                    loop: true,
                    muted: true,
                    controls: false,
                    playsinline: true,
                    poster: poster_url_desktop,
                    class: 'hero-slider__video-element',
                    id: 'video-'
                  | append: block.id
                }}
              </div>
            {% endif %}

            {% if block.settings.mobile_video %}
              <div class="hero-slider__video hero-slider__video--mobile">
                {% assign poster_url_mobile = block.settings.video_poster | image_url %}
                {{
                  block.settings.mobile_video
                  | video_tag:
                    autoplay: true,
                    loop: true,
                    muted: true,
                    controls: false,
                    playsinline: true,
                    poster: poster_url_mobile,
                    class: 'hero-slider__video-element',
                    id: 'mobile-video-'
                  | append: block.id
                }}
              </div>
            {% endif %}
          {% endif %}

          <div class="hero-slider__content hero-slider__content--{{ block.settings.horizontal_alignment | default: 'center' }} hero-slider__content--{{ block.settings.vertical_alignment | default: 'bottom' }} hero-slider__content--mobile-{{ block.settings.mobile_horizontal_alignment | default: 'center' }} hero-slider__content--mobile-{{ block.settings.mobile_vertical_alignment | default: block.settings.vertical_alignment | default: 'bottom' }}">
            {% if block.settings.svg_image %}
              <img
                src="{{ block.settings.svg_image | image_url }}"
                alt="{{ block.settings.heading | escape }}"
                class="hero-slider__svg hero-slider__svg--{{ block.settings.svg_size | default: 'medium' }} hero-slider__svg--desktop"
                width="{{ block.settings.svg_image.width }}"
                height="{{ block.settings.svg_image.height }}"
                loading="lazy"
              >
              {% if block.settings.mobile_svg_image %}
                <img
                  src="{{ block.settings.mobile_svg_image | image_url }}"
                  alt="{{ block.settings.heading | escape }}"
                  class="hero-slider__svg hero-slider__svg--{{ block.settings.svg_size | default: 'medium' }} hero-slider__svg--mobile"
                  width="{{ block.settings.mobile_svg_image.width }}"
                  height="{{ block.settings.mobile_svg_image.height }}"
                  loading="lazy"
                >
              {% endif %}
            {% elsif block.settings.heading %}
              <{{ block.settings.heading_level | default: 'h1' }} class="heading--3xl {% if block.settings.heading_animation != 'none' %}{{ block.settings.heading_animation }}{% endif %}">
                {{ block.settings.heading }}
              </{{ block.settings.heading_level | default: 'h1' }}>
            {% endif %}

            <div class="hero-slider__description heading--l {% if block.settings.description_animation != 'none' %}{{ block.settings.description_animation }}{% endif %}">
              {{ block.settings.description }}
            </div>

            <div class="hero-slider__buttons">
              {% for i in (1..4) %}
                {% assign button_label = 'button_label_' | append: i %}
                {% assign button_link = 'button_link_' | append: i %}
                {% if block.settings[button_label] and block.settings[button_link] %}
                  <a
                    href="{{ block.settings[button_link] }}"
                    class="button button--white body"
                    aria-label="{{ block.settings[button_label] | escape }}"
                  >
                    {{ block.settings[button_label] }}
                  </a>
                {% endif %}
              {% endfor %}
            </div>
          </div>
        </li>
      {% endfor %}
    </ul>
  </div>
  <div class="splide__pagination"></div>
</div>

<script
  src="{{ "section-hero-slider.js" | asset_url }}"
  data-section-id="{{ section.id }}"
  data-autoplay="{{ section.settings.autoplay }}"
  data-slide-interval="{{ section.settings.slide_interval | times: 1000 }}"
  defer
></script>

{% schema %}
{
  "name": "Hero Slider",
  "tag": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay slides",
      "default": true
    },
    {
      "type": "range",
      "id": "slide_interval",
      "min": 3,
      "max": 30,
      "step": 1,
      "unit": "sec",
      "label": "Change slides every",
      "default": 5
    }
  ],
  "max_blocks": 4,
  "blocks": [
    {
      "name": "Slide",
      "type": "slide",
      "settings": [
        {
          "type": "select",
          "id": "media_type",
          "label": "Media Type",
          "options": [
            {
              "value": "image",
              "label": "Image"
            },
            {
              "value": "video",
              "label": "Video"
            }
          ],
          "default": "image"
        },
        {
          "type": "image_picker",
          "id": "desktop_image",
          "label": "Desktop Image",
          "info": "Used when Media Type is set to Image"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "Mobile Image (optional)",
          "info": "If not provided, Desktop Image will be used on mobile devices"
        },
        {
          "type": "video",
          "id": "video",
          "label": "Desktop Video",
          "info": "Used when Media Type is set to Video"
        },
        {
          "type": "video",
          "id": "mobile_video",
          "label": "Mobile Video (optional)",
          "info": "If not provided, Desktop Video will be used on mobile devices"
        },
        {
          "type": "image_picker",
          "id": "video_poster",
          "label": "Desktop Video Poster Image",
          "info": "Shown while desktop video loads"
        },
        {
          "type": "image_picker",
          "id": "mobile_video_poster",
          "label": "Mobile Video Poster Image",
          "info": "Shown while mobile video loads"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Welcome to Our Store"
        },
        {
          "type": "image_picker",
          "id": "svg_image",
          "label": "SVG Image (replaces heading)",
          "info": "Upload an SVG file. If selected, this will be used instead of the heading text above."
        },
        {
          "type": "select",
          "id": "svg_size",
          "label": "SVG Size",
          "options": [
            {
              "value": "small",
              "label": "Small (320px max)"
            },
            {
              "value": "medium",
              "label": "Medium (650px max)"
            },
            {
              "value": "large",
              "label": "Large (900px max)"
            },
            {
              "value": "full",
              "label": "Full (100%)"
            }
          ],
          "default": "medium",
          "info": "Maximum width for SVG image. Image will never exceed screen width."
        },
        {
          "type": "image_picker",
          "id": "mobile_svg_image",
          "label": "Mobile SVG Image",
          "info": "Please provide a mobile SVG, you can reuse the same one from Desktop if needed"
        },
        {
          "type": "select",
          "id": "heading_level",
          "label": "Heading Level",
          "options": [
            {
              "value": "h1",
              "label": "H1"
            },
            {
              "value": "h2",
              "label": "H2"
            },
            {
              "value": "h3",
              "label": "H3"
            },
            {
              "value": "h4",
              "label": "H4"
            },
            {
              "value": "h5",
              "label": "H5"
            },
            {
              "value": "h6",
              "label": "H6"
            }
          ],
          "default": "h1"
        },
        {
          "type": "select",
          "id": "heading_animation",
          "label": "Heading Animation",
          "options": [
            {
              "value": "none",
              "label": "None"
            },
            {
              "value": "animate-word-slide-up-scroll",
              "label": "Slide Up Words"
            },
            {
              "value": "animate-word-rotate-scroll",
              "label": "Rotate In Words"
            },
            {
              "value": "animate-paragraph-slide-up-scroll",
              "label": "Slide Up"
            }
          ],
          "default": "none"
        },
        {
          "type": "text",
          "id": "description",
          "label": "Description",
          "default": "Discover our latest collection"
        },
        {
          "type": "select",
          "id": "description_animation",
          "label": "Description Animation",
          "options": [
            {
              "value": "none",
              "label": "None"
            },
            {
              "value": "animate-word-slide-up-scroll",
              "label": "Slide Up Words"
            },
            {
              "value": "animate-word-rotate-scroll",
              "label": "Rotate In Words"
            },
            {
              "value": "animate-paragraph-slide-up-scroll",
              "label": "Slide Up"
            }
          ],
          "default": "none"
        },
        {
          "type": "text",
          "id": "button_label_1",
          "label": "Button 1 Text",
          "default": "Shop Now"
        },
        {
          "type": "url",
          "id": "button_link_1",
          "label": "Button 1 Link"
        },
        {
          "type": "text",
          "id": "button_label_2",
          "label": "Button 2 Text"
        },
        {
          "type": "url",
          "id": "button_link_2",
          "label": "Button 2 Link"
        },
        {
          "type": "text",
          "id": "button_label_3",
          "label": "Button 3 Text"
        },
        {
          "type": "url",
          "id": "button_link_3",
          "label": "Button 3 Link"
        },
        {
          "type": "text",
          "id": "button_label_4",
          "label": "Button 4 Text"
        },
        {
          "type": "url",
          "id": "button_link_4",
          "label": "Button 4 Link"
        },
        {
          "type": "select",
          "id": "horizontal_alignment",
          "label": "Horizontal Alignment",
          "default": "center",
          "options": [
            {
              "value": "left",
              "label": "Left"
            },
            {
              "value": "center",
              "label": "Center"
            },
            {
              "value": "right",
              "label": "Right"
            }
          ]
        },
        {
          "type": "select",
          "id": "vertical_alignment",
          "label": "Vertical Alignment",
          "default": "bottom",
          "options": [
            {
              "value": "top",
              "label": "Top"
            },
            {
              "value": "middle",
              "label": "Middle"
            },
            {
              "value": "stretch",
              "label": "Stretch"
            },
            {
              "value": "bottom",
              "label": "Bottom"
            }
          ]
        },
        {
          "type": "select",
          "id": "mobile_horizontal_alignment",
          "label": "Mobile Horizontal Alignment",
          "default": "center",
          "options": [
            {
              "value": "left",
              "label": "Left"
            },
            {
              "value": "center",
              "label": "Center"
            },
            {
              "value": "right",
              "label": "Right"
            }
          ]
        },
        {
          "type": "select",
          "id": "mobile_vertical_alignment",
          "label": "Mobile Vertical Alignment",
          "default": "bottom",
          "options": [
            {
              "value": "top",
              "label": "Top"
            },
            {
              "value": "middle",
              "label": "Middle"
            },
            {
              "value": "bottom",
              "label": "Bottom"
            }
          ]
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Hero Slider",
      "category": "Hero",
      "blocks": [
        {
          "type": "slide"
        }
      ]
    }
  ],
  "enabled_on": {
    "templates": ["index", "page", "article", "blog"]
  }
}
{% endschema %}
