{% comment %}
  Main product gallery and information
{% endcomment %}

{% assign current_variant = null %}

{% for variant in product.variants %}
  {% if variant.available and variant.inventory_quantity > 5 %}
    {% assign current_variant = variant %}
    {% break %}
  {% endif %}
{% endfor %}

{% if current_variant == null %}
  {% assign current_variant = product.selected_or_first_available_variant %}
{% endif %}

<style>
  .product-images-container {
    position: relative;
    overflow: hidden;
  }

  .product-images-container--mobile {
    width: 100%;
    height: auto;
    aspect-ratio: auto;
  }

  .product-images-container--mobile .splide__slide {
    position: relative;
    padding-bottom: 75%;
  }

  .product-images-container--mobile .splide__slide img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .product-images-splide .splide__track {
    height: 100%;
  }

  .product-images-splide .splide__list {
    height: 100% !important;
  }

  .product-images-splide .splide__slide {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    background-color: var(--neutral-50);
    position: relative;
  }

  .product-images-splide .splide__slide img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    object-position: top;
  }

  .product-images-splide .splide__slide:before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--neutral-50);
    z-index: -1;
  }

  .product-images-progress {
    position: absolute;
    left: var(--space-m);
    top: 50%;
    width: 2px;
    transform: translateY(-50%);
    height: 50%;
    z-index: 10;
  }

  .product-images-progress--mobile {
    left: 0;
    top: auto;
    bottom: -4px;
    width: 100%;
    height: 4px;
  }

  .product-images-progress__bar {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 0;
    background-color: var(--neutral-950);
    transition: height 0.3s ease;
  }

  .product-images-progress--mobile .product-images-progress__bar {
    width: 0;
    height: 100%;
  }

  .product-images-splide .splide__arrows {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 10;
    margin: 0;
    pointer-events: none;
  }

  .product-images-splide .splide__arrow {
    background-color: transparent;
    border: none;
    width: calc(var(--space-m) + var(--space-m));
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    opacity: 1;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    pointer-events: auto;
    padding: 0;
  }

  .product-images-splide .splide__arrow--prev {
    left: 0px;
  }

  .product-images-splide .splide__arrow--next {
    right: 0px;
  }

  .product-images-splide .splide__arrow:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .product-images-splide .splide__arrow svg {
    width: 7px;
    height: 12px;
  }

  #product {
    display: flex;
    gap: 0;
  }

  #product .product-top-breadcrumb-container .breadcrumb__list {
    display: none;
  }

  .product-details__container {
    position: relative;
    overflow-y: auto;
    scrollbar-gutter: stable both-edges;
    width: 50vw;
  }

  .product-details__fade-overlay {
    position: sticky;
    bottom: 0;
    left: 0;
    width: 100%;
    height: var(--space-3xl);
    background: linear-gradient(to bottom, transparent, rgba(255, 255, 255, 0.9) 50%, var(--white));
    pointer-events: none;
  }

  #product-details {
    padding: var(--space-2xl);
    margin: 0 auto;
  }

  .product-details__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-2xs);
    gap: var(--space-m);
  }

  .product-details__title {
    color: var(--neutral-950);
  }

  .product-details__price {
    display: flex;
    gap: var(--space-xs);
  }

  .product-details__compare-price {
    color: var(--neutral-600);
    text-decoration: line-through;
  }

  .product-details__price-actual {
    color: var(--neutral-950);
  }

  .product-details__info-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-l);
  }

  .product-details__sku {
    color: var(--neutral-600);
    margin-bottom: var(--space-2xs);
  }

  .size-guide-button {
    color: var(--neutral-600);
    background: none;
    border: none;
    padding: 0;
    cursor: pointer;
    text-decoration: underline;
  }

  .size-guide-button:hover {
    color: var(--neutral-950);
  }

  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
  }

  .modal-overlay.is-active {
    opacity: 1;
    visibility: visible;
  }

  .modal-overlay.is-active .size-guide-container {
    opacity: 1;
    transform: translateY(0);
  }

  body.modal-open {
    overflow: hidden;
    position: fixed;
    width: 100%;
    height: 100%;
  }

  .modal-content {
    background-color: var(--white);
    padding: var(--space-xl);
    max-width: 80%;
    overflow-y: auto;
    position: relative;
    transform: translateY(var(--space-xl));
  }

  .modal-overlay.is-active .modal-content {
    transform: translateY(0);
  }

  .modal-close {
    background: none;
    border: none;
    padding: var(--space-2xs);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  body.modal-open {
    overflow: hidden;
  }

  .variant-options {
    border: none;
    margin: 0 0 var(--space-m) 0;
    padding: 0;
  }

  .variant-options legend {
    margin-bottom: var(--space-xs);
    color: var(--neutral-950);
  }

  .variant-options__list {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-xs);
    align-items: center;
  }

  .variant-option {
    position: relative;
  }

  .variant-option input[type='radio'] {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
  }

  .variant-option label {
    padding: 0;
    color: var(--neutral-950);
    cursor: pointer;
    position: relative;
    display: inline-block;
  }

  .variant-option label {
    border: 1px solid var(--neutral-200);
    padding: var(--space-2xs) var(--space-2xs);
  }

  .variant-option input[type='radio']:checked + label {
    border: 1px solid var(--neutral-950);
  }

  .variant-option input[type='radio']:checked + label::after {
    display: none;
  }

  .variant-option input[type='radio']:disabled + label {
    color: var(--neutral-200);
    cursor: not-allowed;
  }

  #js--addtocart {
    width: 100%;
    background-color: var(--neutral-950);
    color: var(--white);
    border: none;
    padding: var(--space-s) var(--space-m);
    cursor: pointer;
    margin-bottom: var(--space-s);
    display: flex;
    justify-content: center;
    align-items: center;
  }

  #js--addtocart:disabled {
    background-color: var(--neutral-200);
    cursor: not-allowed;
  }

  #js--addtocart:hover:not(:disabled) {
    background-color: var(--neutral-950);
  }

  .klaviyo-form-WMidEs {
    margin-bottom: var(--space-s);
  }

  .klaviyo-form-WMidEs > div > form > div > div > div > div > input,
  .klaviyo-form-WMidEs > div > form > div > div > div > button {
    height: var(--space-xl) !important;
    padding: 0px !important;
    border: none !important;
    border-bottom: 1px solid black !important;
    box-sizing: border-box !important;
    margin-bottom: var(--space-s) !important;
  }

  #opt_in_promotional_sms__4__5 ~ label {
    align-items: center !important;
  }

  #opt_in_promotional_sms__4__5 ~ label > svg {
    border: 1px solid var(--neutral-950);
    width: 20px !important;
  }

  #opt_in_promotional_sms__4__5 ~ label:hover > svg {
    stroke: none !important;
  }

  #opt_in_promotional_sms__4__5 ~ label > .needsclick {
    line-height: 140% !important;
    letter-spacing: 0.065rem !important;
    font-family: 'Ordinary Light' !important;
    font-size: clamp(0.6944rem, 0.6597rem + 0.1736vw, 0.8681rem) !important;
    font-weight: 300 !important;
  }

  .product-tabs__list {
    display: flex;
    gap: var(--space-l);
    border-bottom: 1px solid var(--neutral-50);
    margin-bottom: var(--space-m);
  }

  .product-tabs__tab {
    position: relative;
    padding: var(--space-xs) 0;
    background: none;
    border: none;
    color: var(--neutral-600);
    cursor: pointer;
  }

  .product-tabs__tab:hover {
    color: var(--neutral-950);
  }

  .product-tabs__tab.is-active {
    color: var(--neutral-950);
  }

  .product-tabs__tab.is-active {
    border-bottom: 1px solid var(--neutral-950);
    margin-bottom: -1px;
  }

  .product-tabs__tab.is-active::after {
    display: none;
  }

  .product-tabs__content {
    display: none;
  }

  .product-tabs__content.is-active {
    display: block;
    color: var(--neutral-600);
  }

  .product-tabs__description,
  .product-tabs__specifications,
  .product-tabs__shipping {
    color: var(--neutral-600);
  }

  .product-tabs__description > p {
    margin-bottom: var(--space-m);
  }

  .product-tabs__description > p > strong {
    color: var(--neutral-950);
    font-family: 'Ordinary Regular';
    font-weight: 500;
  }

  .product-tabs__description > a,
  .product-tabs__description > * > a,
  .product-tabs__description > * > * > a {
    color: var(--neutral-600);
  }

  .product-tabs__description-usp-hr {
    border: 0;
    border-top: 1px solid var(--neutral-50);
    margin-bottom: var(--space-m);
  }

  .product-tabs__description-usp {
    color: var(--neutral-600);
  }

  .product-tabs__metafield {
    margin-bottom: var(--space-m);
  }

  .product-tabs__content-shipping > * {
    margin-bottom: var(--space-m);
  }

  .product-tabs__metafield h4 {
    margin-bottom: var(--space-xs);
    color: var(--neutral-950);
  }

  .product-error {
    color: #ff0000;
    margin-bottom: var(--space-3xs);
  }

  .sticky-cart-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background-color: var(--white);
    border-top: 1px solid var(--neutral-50);
    padding: var(--space-s) var(--space-m);
    z-index: 50;
    transform: translateY(100%);
    transition: transform 0.3s ease;
  }

  .sticky-cart-bar.is-visible {
    transform: translateY(0);
  }

  .sticky-cart-bar__container {
    margin: 0 auto;
    display: flex;
    align-items: center;
    gap: var(--space-m);
  }

  .sticky-cart-bar__product-info {
    flex: 1;
    color: var(--neutral-950);
  }

  .sticky-cart-bar__product-info .heading--l {
    display: inline;
  }

  .sticky-cart-bar #js--addtocart {
    margin-bottom: 0;
    max-width: 200px;
    flex-shrink: 0;
  }

  .sticky-cart-bar__thumbnail {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .sticky-cart-bar__thumbnail img {
    max-width: 60px;
    max-height: 60px;
    width: auto;
    height: auto;
  }

  .sticky-cart-bar__product-title {
    flex: 1;
    color: var(--neutral-950);
  }

  .sticky-cart-bar__price-container {
    display: flex;
    gap: var(--space-xs);
    align-items: center;
  }

  .sticky-cart-bar__compare-price {
    color: var(--neutral-600);
    text-decoration: line-through;
  }

  .sticky-cart-bar__price {
    color: var(--neutral-950);
  }

  .sticky-cart-bar__mobile-info {
    width: 100%;
    justify-content: space-between;
    align-items: center;
    padding-bottom: var(--space-s);
  }

  .sticky-cart-bar__mobile-title {
    flex: 1;
    color: var(--neutral-950);
  }

  .sticky-cart-bar__mobile-price-container {
    display: flex;
    gap: var(--space-xs);
    align-items: center;
  }

  .sticky-cart-bar__mobile-compare-price {
    color: var(--neutral-600);
    text-decoration: line-through;
  }

  .sticky-cart-bar__mobile-price {
    color: var(--neutral-950);
  }

  @media screen and (min-width: 1100px) {
    #product {
      align-items: flex-start;
    }

    #product-details {
      max-width: 800px;
    }

    .product-top-breadcrumb-container {
      display: none;
    }

    .product-images-container {
      width: 50vw;
      max-width: 50vw;
    }

    .product-details__container {
      -ms-overflow-style: none;
      scrollbar-width: none;
      max-height: calc({{product.images[0].height}} * 50vw / {{product.images[0].width}});
      overflow-y: auto;
    }

    .product-details__container::-webkit-scrollbar {
      display: none;
    }

    .sticky-cart-bar__product-info {
      display: none;
    }

    .sticky-cart-bar__container {
      justify-content: space-between;
    }

    .sticky-cart-bar__thumbnail {
      display: flex;
    }

    .sticky-cart-bar__product-title {
      display: block;
    }

    .sticky-cart-bar__price-container {
      display: flex;
    }
    .sticky-cart-bar__mobile-info {
      display: none;
    }
  }

  @media screen and (max-width: 1099px) {
    header {
      border-bottom: none;
    }

    #product {
      flex-direction: column;
    }

    #product .product-top-breadcrumb-container .breadcrumb__list {
      display: flex;
      justify-content: start;
      padding: var(--space-s) var(--space-m);
      border-top: 1px solid var(--neutral-50);
      flex-wrap: nowrap;
      overflow-x: scroll;
    }

    #product .product-top-breadcrumb-container .breadcrumb__list li {
      white-space: nowrap;
    }

    .product-details__container {
      width: 100%;
      height: auto;
      scrollbar-gutter: auto;
    }

    #product-details {
      width: 100%;
      height: auto;
      padding: var(--space-m);
    }

    .product-details__header {
      flex-direction: column;
      gap: var(--space-2xs);
      align-items: start;
    }

    .product-images-splide .splide__arrows {
      display: none;
    }

    .product-images-container--mobile .splide__arrows {
      display: block;
    }

    .modal-content {
      max-width: 100%;
      width: 100%;
      max-height: 90%;
      height: 100%;
      margin: 0 var(--space-m);
    }

    .product-details__fade-overlay {
      display: none;
    }

    .product-tabs__list {
      margin-bottom: 0px;
      justify-content: space-between;
    }

    .product-tabs__description > p,
    .product-tabs__content > div {
      margin-top: var(--space-m);
      margin-bottom: 0px;
    }

    .product-tabs__tab {
      font-size: 10px !important;
    }

    .sticky-cart-bar {
      padding: 0;
    }

    .sticky-cart-bar {
      padding: 0;
    }

    .sticky-cart-bar__container {
      flex-direction: column;
      gap: 0;
      padding: var(--space-s) var(--space-m);
    }

    .sticky-cart-bar__thumbnail {
      display: none;
    }

    .sticky-cart-bar__product-title {
      display: none;
    }

    .sticky-cart-bar__price-container {
      display: none;
    }

    .sticky-cart-bar__product-info {
      display: none;
    }

    .sticky-cart-bar__mobile-info {
      display: flex;
    }

    .sticky-cart-bar #js--addtocart {
      max-width: none;
      width: 100%;
      margin: 0;
    }
  }
</style>

<script>
  var current_variant = {{ current_variant | json }};
  var variants = {{ product.variants | json }};
  var default_image = {{ product.featured_image.id | default: 'null' }};
  var product_type = {{ product.type | json }};
  var variant_inventory_quantities = [{% for variant in product.variants %}{{ variant.inventory_quantity }}{% unless forloop.last %},{% endunless %}{% endfor %}];
  var product_title = {{ product.title | json }};
  var product_options = {{ product.options | json }};
  var show_low_stock_warning = {{ section.settings.show_low_stock_warning | json }};
</script>

<div class="section-wrap">
  <div id="product">
    <div class="product-top-breadcrumb-container">
      {% render 'breadcrumb' %}
    </div>
    <div class="product-images-container">
      <div class="splide product-images-splide">
        <div class="splide__arrows">
          <button class="splide__arrow splide__arrow--prev">
            <svg width="7" height="12" viewBox="0 0 7 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6 1L1 6L6 11" stroke="#0F0F0F" stroke-linecap="square"/>
            </svg>
          </button>
          <button class="splide__arrow splide__arrow--next">
            <svg width="7" height="12" viewBox="0 0 7 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 1L6 6L1 11" stroke="#0F0F0F" stroke-linecap="square"/>
            </svg>
          </button>
        </div>

        <div class="splide__track">
          <ul class="splide__list">
            {% if product.images.size == 0 %}
              <li class="splide__slide">
                {{ 'collection-4' | placeholder_svg_tag: 'placeholder' }}
              </li>
            {% endif %}
            {% for image in product.images %}
              <li class="splide__slide" data-imageid="{{ image.id }}">
                {% if forloop.first %}
                  {{
                    image
                    | image_url: width: image.width
                    | image_tag:
                      sizes: '(max-width: 768px) 400px, 1200px',
                      alt: image.alt,
                      loading: 'eager',
                      decoding: 'async',
                      fetchpriority: 'high'
                  }}
                {% else %}
                  {{
                    image
                    | image_url: width: image.width
                    | image_tag:
                      sizes: '(max-width: 768px) 400px, 1200px',
                      alt: image.alt,
                      loading: 'lazy',
                      decoding: 'async'
                  }}
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        </div>

        <div class="product-images-progress">
          <div class="product-images-progress__bar"></div>
        </div>
      </div>
    </div>

    <section class="product-details__container custom-scrollbar">
      <div id="product-details">
        {% if current_variant.sku %}
          <p class="product-details__sku small">
            Product Code:
            <span class="js--variant-sku">{{ current_variant.sku }}</span>
          </p>
        {% endif %}
        <div class="product-details__header">
          <h1 class="product-details__title heading--xl" data-title="{{ product.title }}">{{ product.title }}</h1>
          <div class="product-details__price">
            {% if current_variant.compare_at_price > current_variant.price %}
              <span class="product-details__compare-price body js--variant-compareatprice">
                {{ current_variant.compare_at_price | money }}
              </span>
            {% endif %}
            <span class="product-details__price-actual body js--variant-price">
              {{ current_variant.price | money }}
            </span>
          </div>
        </div>

        <div class="product-details__info-container">
          <p class="small" style="color: var(--neutral-600);">
            {{ product.metafields.custom.discount_bundle_name | metafield_tag }}
          </p>
          <button
            type="button"
            class="size-guide-button small"
          >
            What's my size?
          </button>
        </div>

        <div>
          {% for variant_product in product.metafields.custom.product_colour_variants.value %}
            {{ variant_product.url }}
            <br>
            {{
              variant_product.featured_image
              | image_url: width: 400
              | image_tag:
                alt: variant_product.featured_image.alt,
                loading: 'lazy',
                decoding: 'async',
                class: 'shop-the-look-global__product-image',
                widths: '200, 300, 400, 500, 600',
                sizes: '(max-width: 768px) 100vw, 50vw'
            }}
            {{ variant_product.featured_image }}
          {% endfor %}
        </div>

        <form action="{{ routes.cart_add_url }}" method="post" onsubmit="return false;" id="js--variant-form">
          {%- for block in section.blocks -%}
            {% case block.type %}
              {%- when '@app' -%}
                {% render block %}

              {%- when 'options' %}
                {% unless product.has_only_default_variant %}
                  {% for option_group in product.options_with_values %}
                    {% assign option_field = option_group.position | prepend: 'option' %}
                    <fieldset class="variant-options js--variant-options">
                      <legend class="body--bold">{{ option_group.name }}:</legend>
                      <div class="variant-options__list">
                        {% for value in option_group.values %}
                          {% capture option_id %}{{ option_group.name }}_{{ value }}{% endcapture %}
                          <div class="variant-option">
                            <input
                              type="radio"
                              id="{{ option_id | handleize }}"
                              class="js--variant-option"
                              name="{{ option_group.position | prepend: 'option'}}"
                              value="{{ value }}"
                              {% if current_variant[option_field] == value %}
                                checked
                              {% endif %}
                            >
                            <label for="{{ option_id | handleize }}" class="body">
                              {% if option_group.name == 'Size' and value contains '.0' %}
                                {{- value | remove: '.0' -}}
                              {% else %}
                                {{- value -}}
                              {% endif %}
                            </label>
                          </div>
                        {% endfor %}
                      </div>
                    </fieldset>
                  {% endfor %}
                  {% if product.metafields.custom.show_pants_size_for_suits %}
                    <p class="small" style="margin-bottom: var(--space-m); color: var(--neutral-600);">
                      Suit Includes Trousers Size:
                      <span class="js--pants-size">{{ current_variant.option1 | minus: 12 }}</span>
                    </p>
                  {% endif %}
                {% endunless %}

              {%- when 'button' -%}
                <input
                  type="hidden"
                  id="js--variant-id"
                  name="id"
                  value="{{ current_variant.id }}"
                >
                <input
                  type="hidden"
                  id="js--variant-inventory-quantity"
                  value="{{ current_variant.inventory_quantity }}"
                >

                {% if current_variant.available and product.gift_card? %}
                  <button
                    type="submit"
                    id="js--addtocart"
                    class="body"
                    style="height: var(--space-xl);"
                  >
                    Add To Cart
                  </button>
                {% elsif current_variant.available and current_variant.inventory_quantity > 5 %}
                  <button
                    type="submit"
                    id="js--addtocart"
                    class="body"
                    style="height: var(--space-xl);"
                  >
                    {% if section.settings.show_low_stock_warning
                      and current_variant.available
                      and current_variant.inventory_quantity >= 6
                      and current_variant.inventory_quantity <= 10
                      and product.gift_card? == false
                    %}
                      Low In Stock - Add To Cart
                    {% else %}
                      Add To Cart
                    {% endif %}
                  </button>
                {% else %}
                  <button
                    type="submit"
                    id="js--addtocart"
                    class="body"
                    style="height: var(--space-xl); display: none;"
                  >
                    Add To Cart
                  </button>
                {% endif %}
                <button
                  type="button"
                  id="js--notify-me"
                  class="body"
                  style="height: var(--space-xl); width: 100%; background-color: var(--neutral-950); color: var(--white); border: none; padding: var(--space-s) var(--space-m); cursor: pointer; margin-bottom: var(--space-s); {% if current_variant.available and product.gift_card? %}display: none;{% elsif current_variant.available and current_variant.inventory_quantity > 5 %}display: none;{% else %}display: block;{% endif %}"
                >
                  Out of Stock - Notify Me
                </button>

                <div
                  class="klaviyo-form-WMidEs"
                  style="{% if current_variant.available and product.gift_card? %}display: none;{% elsif current_variant.available and current_variant.inventory_quantity > 5 %}display: none;{% else %}display: none;{% endif %}"
                ></div>
            {%- endcase -%}
          {%- endfor -%}
        </form>

        {% assign has_description = false %}
        {% assign has_specs = false %}
        {% assign has_shipping = false %}

        {% if product.description != blank %}
          {% assign has_description = true %}
        {% endif %}

        {% if product.metafields.custom.care_guide != blank
          or product.metafields.custom.garment_fit != blank
          or product.metafields.custom.product_specifications != blank
        %}
          {% assign has_specs = true %}
        {% endif %}

        {% if section.settings.shipping_content != blank %}
          {% assign has_shipping = true %}
        {% endif %}

        {% if has_description or has_specs or has_shipping %}
          <div class="product-tabs">
            <div class="product-tabs__list">
              {% if has_description %}
                <button class="product-tabs__tab body--uppercase" data-tab="description">Product Info</button>
              {% endif %}
              {% if has_specs %}
                <button class="product-tabs__tab body--uppercase" data-tab="specs">Specifications And Care</button>
              {% endif %}
              {% if has_shipping %}
                <button class="product-tabs__tab body--uppercase" data-tab="shipping">Shipping</button>
              {% endif %}
            </div>

            {% if has_description %}
              <div class="product-tabs__content" data-content="description">
                <div class="product-tabs__description rte body">
                  {{ product.description }}
                  {% if section.settings.show_usps %}
                    <hr
                      class="product-tabs__description-usp-hr"
                    >
                    <ul>
                      <li>
                        {% if product.price > 9900 %}
                          <strong class="body--bold product-tabs__description-usp"
                            >Complimentary standard shipping on this item.</strong
                          >
                        {% else %}
                          <strong class="body--bold product-tabs__description-usp"
                            >Complimentary standard shipping over $99.</strong
                          >
                        {% endif %}
                      </li>
                      <li>
                        <strong class="body--bold product-tabs__description-usp">30 Day Returns Policy</strong>
                      </li>
                      {% if product.metafields.custom.fabric_description %}
                        <li>
                          <strong class="body--bold product-tabs__description-usp">
                            {{- product.metafields.custom.fabric_description -}}
                          </strong>
                        </li>
                      {% endif %}
                    </ul>
                  {% endif %}
                </div>
              </div>
            {% endif %}

            {% if has_specs %}
              <div class="product-tabs__content" data-content="specs">
                {% if product.metafields.custom.garment_fit != blank %}
                  <div class="product-tabs__metafield">
                    <h4 class="body--bold">Sizing Information</h4>
                    <div class="body">{{ product.metafields.custom.garment_fit | metafield_tag }}</div>
                  </div>
                {% endif %}

                {% if product.metafields.custom.product_specifications != blank %}
                  <div class="product-tabs__metafield">
                    <h4 class="body--bold">Specifications</h4>
                    <div class="body">{{ product.metafields.custom.product_specifications | metafield_tag }}</div>
                  </div>
                {% endif %}

                {% if product.metafields.custom.care_guide != blank %}
                  <div class="product-tabs__metafield">
                    <h4 class="body--bold">Fabric and Care</h4>
                    <div class="body">{{ product.metafields.custom.care_guide | metafield_tag }}</div>
                  </div>
                {% endif %}
              </div>
            {% endif %}

            {% if has_shipping %}
              <div class="product-tabs__content" data-content="shipping">
                <div class="body product-tabs__content-shipping">
                  {{ section.settings.shipping_content }}
                </div>
              </div>
            {% endif %}
          </div>
        {% endif %}
      </div>
      <div class="product-details__fade-overlay"></div>
    </section>
  </div>
</div>

<div class="sticky-cart-bar">
  <div class="sticky-cart-bar__container">
    <div class="sticky-cart-bar__thumbnail">
      {% if product.featured_image %}
        {{ product.featured_image | image_url: width: 120 | image_tag: alt: product.title }}
      {% else %}
        {{ 'collection-4' | placeholder_svg_tag: 'placeholder' }}
      {% endif %}
    </div>

    <div class="sticky-cart-bar__product-title heading--l">
      {{ product.title }}
    </div>

    <div class="sticky-cart-bar__price-container">
      {% if current_variant.compare_at_price > current_variant.price %}
        <span class="sticky-cart-bar__compare-price body js--sticky-compare-price">
          {{ current_variant.compare_at_price | money }}
        </span>
      {% endif %}
      <span class="sticky-cart-bar__price body js--sticky-price">
        {{ current_variant.price | money }}
      </span>
    </div>

    <div class="sticky-cart-bar__mobile-info">
      <div class="sticky-cart-bar__mobile-title body">
        {{ product.title }}
      </div>
      <div class="sticky-cart-bar__mobile-price-container">
        {% if current_variant.compare_at_price > current_variant.price %}
          <span class="sticky-cart-bar__mobile-compare-price body js--sticky-mobile-compare-price">
            {{ current_variant.compare_at_price | money }}
          </span>
        {% endif %}
        <span class="sticky-cart-bar__mobile-price body js--sticky-mobile-price">
          {{ current_variant.price | money }}
        </span>
      </div>
    </div>

    <div class="sticky-cart-bar__product-info body">
      <span class="js--sticky-product-info"></span>
    </div>
  </div>
</div>

<div class="modal-overlay">
  <div class="modal-content custom-scrollbar">
    {% render 'size-guide' %}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    
    if (typeof Alpine === 'undefined') {
      console.warn('Alpine.js is required for the size guide modal');
    }

    const sizeGuideButton = document.querySelector('.size-guide-button');
    const modalOverlay = document.querySelector('.modal-overlay');
    const modalClose = document.querySelector('.modal-close');

    if (sizeGuideButton && modalOverlay) {
      sizeGuideButton.addEventListener('click', function () {
        modalOverlay.classList.add('is-active');
        document.body.classList.add('modal-open');
      });

      modalOverlay.addEventListener('click', function (e) {
        if (e.target === modalOverlay) {
          modalOverlay.classList.remove('is-active');
          document.body.classList.remove('modal-open');
        }
      });

      if (modalClose) {
        modalClose.addEventListener('click', function () {
          modalOverlay.classList.remove('is-active');
          document.body.classList.remove('modal-open');
        });
      }
    }

    if (typeof Splide !== 'undefined') {
      initializeProductSlider();
    } else {
      window.addEventListener('load', function () {
        initializeProductSlider();
      });
    }

    function initializeProductSlider() {
      let splideInstance = null;
      const container = document.querySelector('.product-images-container');
      const progressBar = document.querySelector('.product-images-progress__bar');

      function initSlider() {
        if (splideInstance) {
          splideInstance.destroy();
        }

        const isMobile = window.innerWidth < 1100;

        const options = {
          direction: 'ttb',
          height: {{product.images[0].height}} * (window.innerWidth * 0.5 / {{product.images[0].width}}),
          wheel: true,
          waitForTransition: true,
          arrows: false,
          pagination: false,
          speed: 300,
          drag: true,
          breakpoints: {
            1100: {
              type: 'loop',
              direction: 'ltr',
              height: {{product.images[0].height}} * (window.innerWidth * 1 / {{product.images[0].width}}),
              arrows: true,
              perPage: 1,
              pagination: false,
              rewind: false,
              wheel: false,
              drag: true,
              speed: 300,
              waitForTransition: true,
            },
          },
        };

        splideInstance = new Splide('.product-images-splide', options);

        splideInstance.on('mounted move', function () {
          const end = splideInstance.Components.Controller.getEnd() + 1;
          const rate = Math.min((splideInstance.index + 1) / end, 1);

          if (isMobile) {
            progressBar.style.width = String(100 * rate) + '%';
          } else {
            progressBar.style.height = String(100 * rate) + '%';
          }
        });

        splideInstance.mount();
        if (splideInstance.length <= 1) {
          document.querySelector('.product-images-progress').style.display = 'none';
          if (isMobile) {
            document.querySelector('.splide__arrows').style.display = 'none';
          }
        } else {
          document.querySelector('.product-images-progress').style.display = '';
          if (isMobile) {
            document.querySelector('.splide__arrows').style.display = '';
          }
        }

        if (isMobile) {
          container.classList.add('product-images-container--mobile');
        } else {
          container.classList.remove('product-images-container--mobile');
        }

        const progress = document.querySelector('.product-images-progress');
        if (isMobile) {
          progress.classList.add('product-images-progress--mobile');
        } else {
          progress.classList.remove('product-images-progress--mobile');
        }
      }

      initSlider();

      let resizeTimeout;
      window.addEventListener('resize', function () {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(initSlider, 250);
      });
    }

    const tabButtons = document.querySelectorAll('.product-tabs__tab');
    const tabContents = document.querySelectorAll('.product-tabs__content');

    if (tabButtons.length > 0) {
      const descriptionTab = document.querySelector('[data-tab="description"]');
      if (descriptionTab) {
        descriptionTab.classList.add('is-active');
        const descriptionContent = document.querySelector('[data-content="description"]');
        if (descriptionContent) {
          descriptionContent.classList.add('is-active');
        }
      } else if (tabButtons[0]) {
        tabButtons[0].classList.add('is-active');
        const firstTabContent = document.querySelector(`[data-content="${tabButtons[0].dataset.tab}"]`);
        if (firstTabContent) {
          firstTabContent.classList.add('is-active');
        }
      }

      tabButtons.forEach((button) => {
        button.addEventListener('click', function () {
          const tabName = this.dataset.tab;

          tabButtons.forEach((tab) => tab.classList.remove('is-active'));
          tabContents.forEach((content) => content.classList.remove('is-active'));

          this.classList.add('is-active');
          const activeContent = document.querySelector(`[data-content="${tabName}"]`);

          if (activeContent) {
            activeContent.classList.add('is-active');
          }
        });
      });
    }

    function getSelectedVariantOptions() {
      const selectedOptions = [];
      const optionInputs = document.querySelectorAll('.js--variant-option:checked');
      
      optionInputs.forEach(function(input) {
        let value = input.value;
        if (input.name === 'option1' && value.includes('.0')) {
          value = value.replace('.0', '');
        }
        selectedOptions.push(value);
      });
      
      return selectedOptions;
    }

    function getCurrentVariant() {
      const selectedOptions = [];
      const optionInputs = document.querySelectorAll('.js--variant-option:checked');
      
      optionInputs.forEach(function(input) {
        selectedOptions.push(input.value);
      });

      return variants.find(function(variant) {
        return variant.option1 === selectedOptions[0] &&
               variant.option2 === selectedOptions[1] &&
               variant.option3 === selectedOptions[2];
      }) || current_variant;
    }

    function formatPrice(price) {
      return (price / 100).toLocaleString('en-US', {
        style: 'currency',
        currency: 'USD'
      });
    }

    function updateStickyProductInfo() {
      const stickyInfo = document.querySelector('.js--sticky-product-info');
      if (!stickyInfo) return;

      const selectedOptions = getSelectedVariantOptions();
      const currentVar = getCurrentVariant();
      
      let variantString = '';
      if (selectedOptions.length > 0) {
        variantString = ' ' + selectedOptions.join(' / ');
      }
      
      const priceString = ' - ' + formatPrice(currentVar.price);
      
      stickyInfo.innerHTML = '<span class="heading--l">' + product_title + ':</span>' + variantString + priceString;
    }

    function updateStickyPrices() {
      const currentVar = getCurrentVariant();
      const stickyPrice = document.querySelector('.js--sticky-price');
      const stickyComparePrice = document.querySelector('.js--sticky-compare-price');
      const stickyComparePriceContainer = stickyComparePrice ? stickyComparePrice.parentElement : null;
      
      const stickyMobilePrice = document.querySelector('.js--sticky-mobile-price');
      const stickyMobileComparePrice = document.querySelector('.js--sticky-mobile-compare-price');
      
      const mainPrice = document.querySelector('.js--variant-price');
      const mainComparePrice = document.querySelector('.js--variant-compareatprice');
      
      if (stickyPrice && mainPrice) {
        stickyPrice.textContent = mainPrice.textContent;
      }
      
      if (stickyComparePrice && stickyComparePriceContainer) {
        if (mainComparePrice && mainComparePrice.textContent.trim() !== '') {
          stickyComparePrice.textContent = mainComparePrice.textContent;
          stickyComparePrice.style.display = 'inline';
        } else {
          stickyComparePrice.style.display = 'none';
        }
      }
      
      if (stickyMobilePrice && mainPrice) {
        stickyMobilePrice.textContent = mainPrice.textContent;
      }
      
      if (stickyMobileComparePrice) {
        if (mainComparePrice && mainComparePrice.textContent.trim() !== '') {
          stickyMobileComparePrice.textContent = mainComparePrice.textContent;
          stickyMobileComparePrice.style.display = 'inline';
        } else {
          stickyMobileComparePrice.style.display = 'none';
        }
      }
    }

    function scrollToVariantForm() {
      const productDetails = document.querySelector('#product-details');
      const fixedHeader = document.querySelector('.header-fixed'); 
      
      if (productDetails) {
        const rect = productDetails.getBoundingClientRect();
        const headerHeight = fixedHeader ? fixedHeader.offsetHeight : 0;
        const targetPosition = window.pageYOffset + rect.top - headerHeight + 1;
        
        window.scrollTo({
          top: targetPosition,
          behavior: 'smooth'
        });
      }
    }

    function initStickyCartBar() {
      const originalButton = document.querySelector('#js--addtocart');
      const stickyBar = document.querySelector('.sticky-cart-bar');
      const stickyContainer = document.querySelector('.sticky-cart-bar__container');
      
      if (!originalButton || !stickyBar || !stickyContainer) return;

      const clonedButton = originalButton.cloneNode(true);
      stickyContainer.appendChild(clonedButton);

      function isDesktop() {
        return window.innerWidth >= 1100;
      }

      function syncButtons() {
        const originalNotifyButton = document.querySelector('#js--notify-me');
        const klaviyoForm = document.querySelector('.klaviyo-form-WMidEs');
        
        const isNotifyMeVisible = originalNotifyButton && originalNotifyButton.style.display !== 'none';
        const isKlaviyoVisible = klaviyoForm && klaviyoForm.style.display !== 'none' && klaviyoForm.style.display !== '';
        
        if ({{ product.has_only_default_variant | json }}) {
          if (isNotifyMeVisible || isKlaviyoVisible) {
            clonedButton.textContent = 'Notify Me';
            clonedButton.disabled = false;
            clonedButton.className = originalButton.className;
            const originalStyle = originalButton.getAttribute('style');
            if (originalStyle) {
              clonedButton.setAttribute('style', originalStyle);
            }
            clonedButton.style.display = 'flex';
          } else {
            clonedButton.disabled = originalButton.disabled;
            clonedButton.innerHTML = originalButton.innerHTML;
            clonedButton.className = originalButton.className;
            clonedButton.type = originalButton.type;
            clonedButton.name = originalButton.name;
            clonedButton.value = originalButton.value;
            
            Array.from(originalButton.attributes).forEach(attr => {
              if (attr.name !== 'id') { 
                clonedButton.setAttribute(attr.name, attr.value);
              }
            });
            
            const originalStyle = originalButton.getAttribute('style');
            if (originalStyle) {
              clonedButton.setAttribute('style', originalStyle);
            }
          }
        } else {
          if (isNotifyMeVisible || isKlaviyoVisible) {
            clonedButton.textContent = 'Notify Me';
            clonedButton.disabled = false;
            clonedButton.className = originalButton.className;
            const originalStyle = originalButton.getAttribute('style');
            if (originalStyle) {
              clonedButton.setAttribute('style', originalStyle);
            }
            clonedButton.style.display = 'flex';
          } else {
            if ({{ product.gift_card? | json }}) {
              clonedButton.textContent = 'Select Card Amount';
            } else {
              clonedButton.textContent = 'Select Your Size';
            }
            clonedButton.disabled = false;
            clonedButton.className = originalButton.className;
            const originalStyle = originalButton.getAttribute('style');
            if (originalStyle) {
              clonedButton.setAttribute('style', originalStyle);
            }
          }
        }
      }

      function syncAll() {
        syncButtons();
        updateStickyProductInfo();
        updateStickyPrices();
      }

      clonedButton.addEventListener('click', function(e) {
        e.preventDefault();
        const originalNotifyButton = document.querySelector('#js--notify-me');
        const klaviyoForm = document.querySelector('.klaviyo-form-WMidEs');
        
        const isNotifyMeVisible = originalNotifyButton && originalNotifyButton.style.display !== 'none';
        const isKlaviyoVisible = klaviyoForm && klaviyoForm.style.display !== 'none' && klaviyoForm.style.display !== '';
        
        if (isNotifyMeVisible || isKlaviyoVisible) {
          scrollToVariantForm();
          if (isNotifyMeVisible) {
            setTimeout(() => {
              if (originalNotifyButton) {
                originalNotifyButton.click();
              }
            }, 300);
          }
        } else if (!{{ product.has_only_default_variant | json }}) {
          scrollToVariantForm();
        } else {
          originalButton.click();
        }
      });

      function checkButtonPosition() {
        const originalNotifyButton = document.querySelector('#js--notify-me');
        const klaviyoForm = document.querySelector('.klaviyo-form-WMidEs');
        const addToCartButton = document.querySelector('#js--addtocart');
        
        const isNotifyMeVisible = originalNotifyButton && originalNotifyButton.style.display !== 'none';
        const isKlaviyoVisible = klaviyoForm && klaviyoForm.style.display !== 'none' && klaviyoForm.style.display !== '';
        const isAddToCartVisible = addToCartButton && addToCartButton.style.display !== 'none';
        
        let buttonRect;
        if (isKlaviyoVisible) {
          buttonRect = klaviyoForm.getBoundingClientRect();
        } else if (isNotifyMeVisible) {
          buttonRect = originalNotifyButton.getBoundingClientRect();
        } else if (isAddToCartVisible) {
          buttonRect = addToCartButton.getBoundingClientRect();
        } else {
          buttonRect = originalButton.getBoundingClientRect();
        }
        
        const buttonBottom = buttonRect.bottom;
        
        if (buttonBottom < 0) {
          stickyBar.classList.add('is-visible');
        } else {
          stickyBar.classList.remove('is-visible');
        }
      }

      const variantOptions = document.querySelectorAll('.js--variant-option');
      variantOptions.forEach(function(option) {
        option.addEventListener('change', function() {
          setTimeout(syncAll, 10);
        });
      });

      window.addEventListener('scroll', checkButtonPosition);
      window.addEventListener('resize', function() {
        checkButtonPosition();
        syncAll();
      });

      const mutationObserver = new MutationObserver(syncAll);
      mutationObserver.observe(originalButton, {
        attributes: true,
        childList: true,
        subtree: true
      });

      const notifyButton = document.querySelector('#js--notify-me');
      if (notifyButton) {
        const notifyMutationObserver = new MutationObserver(syncAll);
        notifyMutationObserver.observe(notifyButton, {
          attributes: true,
          childList: true,
          subtree: true
        });
      }

      checkButtonPosition();
      syncAll();
    }

    initStickyCartBar();
  });
</script>

{% schema %}
{
  "name": "Product Page",
  "limit": 1,
  "tag": "section",
  "settings": [
    {
      "type": "richtext",
      "id": "shipping_content",
      "label": "Shipping Information",
      "default": "<p>Standard Shipping - Australia Post Network.</p><p>Free Standard shipping on all orders over $99 within Australia.</p><ul><li>Melbourne Metro – expect delivery 1-3 Business Days from Dispatch.</li><li>All other capital cities – delivery is between 3-5 Business Days from Dispatch.</li><li>Regional Australia – allow a little longer, 5-7 Business Days from Dispatch.</li></ul><p>Express shipping - $15 within Australia.</p><ul><li>Metropolitan Cities (Australia) - Guaranteed 1-2 Business Days from Dispatch.</li><li>Regional Australia – 3-4 Business Days from Dispatch. </li></ul>"
    },
    {
      "type": "checkbox",
      "id": "show_low_stock_warning",
      "label": "Show low stock warning",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_usps",
      "label": "Show USP's",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "options",
      "name": "Product options",
      "limit": 1,
      "settings": []
    },
    {
      "type": "prices",
      "name": "Prices",
      "settings": []
    },
    {
      "type": "button",
      "name": "Add to cart",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "button_label",
          "label": "Button Label",
          "default": "Add To Cart"
        }
      ]
    }
  ],
  "enabled_on": {
    "templates": ["product"]
  }
}
{% endschema %}
