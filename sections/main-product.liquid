{% comment %}
  Main product gallery and information
{% endcomment %}
{% assign current_variant = product.selected_or_first_available_variant %}

{% if product.featured_image %}
  {{
    product.featured_image
    | image_url: width: 1024
    | image_tag:
      widths: '600, 800, 1024, 1440',
      sizes: '(max-width: 768px) 100vw, 50vw',
      preload: true,
      style: 'display: none;'
  }}
{% endif %}

<style>
  .product-images-container {
    position: relative;
    width: 50vw;
    height: calc(100dvh - var(--space-xl));
    overflow: hidden;
  }

  .product-images-container--mobile {
    width: 100%;
    height: auto;
    aspect-ratio: auto;
  }

  .product-images-container--mobile .splide__slide {
    position: relative;
    padding-bottom: 100%;
  }

  .product-images-container--mobile .splide__slide img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .product-images-splide .splide__track {
    height: 100%;
  }

  .product-images-splide .splide__list {
    height: 100% !important;
  }

  .product-images-splide .splide__slide {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    background-color: var(--neutral-50);
    position: relative;
  }

  .product-images-splide .splide__slide img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    object-position: top;
  }

  .product-images-splide .splide__slide:before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--neutral-50);
    z-index: -1;
  }

  .product-images-progress {
    position: absolute;
    left: var(--space-m);
    top: 50%;
    transform: translateY(-50%);
    width: 2px;
    height: 50%;
    z-index: 10;
  }

  .product-images-progress--mobile {
    left: 0;
    top: auto;
    bottom: -4px;
    width: 100%;
    height: 4px;
  }

  .product-images-progress__bar {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 0;
    background-color: var(--neutral-950);
    transition: height 0.3s ease;
  }

  .product-images-progress--mobile .product-images-progress__bar {
    width: 0;
    height: 100%;
    transition: width 0.3s ease;
  }

  .product-images-splide .splide__arrows {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 10;
    margin: 0;
    pointer-events: none;
  }

  .product-images-splide .splide__arrow {
    background-color: transparent;
    border: none;
    width: var(--space-l);
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    opacity: 1;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    pointer-events: auto;
    padding: 0;
  }

  .product-images-splide .splide__arrow--prev {
    left: var(--space-3xs);
  }

  .product-images-splide .splide__arrow--next {
    right: var(--space-3xs);
  }

  .product-images-splide .splide__arrow:disabled {
    opacity: 0.3;
    cursor: default;
  }

  .product-images-splide .splide__arrow svg {
    width: 7px;
    height: 12px;
  }

  #product {
    display: flex;
    gap: 0;
  }

  .product-details__container {
    width: 50vw;
    overflow-y: auto;
  }

  #product-details {
    height: calc(100vh - var(--space-xl));
    padding: var(--space-3xl);
    overflow-y: auto;
    margin: 0 auto;
  }

  .product-details__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-2xs);
    gap: var(--space-m);
  }

  .product-details__title {
    color: var(--neutral-950);
  }

  .product-details__price {
    display: flex;
    gap: var(--space-xs);
  }

  .product-details__compare-price {
    color: var(--neutral-600);
    text-decoration: line-through;
  }

  .product-details__price-actual {
    color: var(--neutral-950);
  }

  .product-details__sku {
    margin-bottom: var(--space-l);
    color: var(--neutral-600);
  }

  .variant-options {
    border: none;
    margin: 0 0 var(--space-m) 0;
    padding: 0;
  }

  .variant-options legend {
    margin-bottom: var(--space-xs);
    color: var(--neutral-950);
  }

  .variant-options__list {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-m);
    align-items: center;
  }

  .variant-option {
    position: relative;
  }

  .variant-option input[type='radio'] {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
  }

  .variant-option label {
    padding: 0;
    color: var(--neutral-950);
    cursor: pointer;
    position: relative;
    display: inline-block;
  }

  .variant-option label {
    border-bottom: 1px solid transparent;
  }

  .variant-option input[type='radio']:checked + label {
    border-bottom: 1px solid var(--neutral-950);
  }

  .variant-option input[type='radio']:checked + label::after {
    display: none;
  }

  .variant-option input[type='radio']:disabled + label {
    color: var(--neutral-200);
    cursor: not-allowed;
  }

  #js--addtocart {
    width: 100%;
    background-color: var(--neutral-950);
    color: var(--white);
    border: none;
    padding: var(--space-s) var(--space-m);
    cursor: pointer;
    margin-bottom: var(--space-s);
  }

  #js--addtocart:disabled {
    background-color: var(--neutral-200);
    cursor: not-allowed;
  }

  #js--addtocart:hover:not(:disabled) {
    background-color: var(--neutral-950);
  }

  .product-tabs__list {
    display: flex;
    gap: var(--space-l);
    border-bottom: 1px solid var(--neutral-200);
    margin-bottom: var(--space-m);
  }

  .product-tabs__tab {
    position: relative;
    padding: var(--space-xs) 0;
    background: none;
    border: none;
    color: var(--neutral-600);
    cursor: pointer;
    transition: color 0.2s ease;
  }

  .product-tabs__tab:hover {
    color: var(--neutral-950);
  }

  .product-tabs__tab.is-active {
    color: var(--neutral-950);
  }

  .product-tabs__tab {
    border-bottom: 1px solid transparent;
  }

  .product-tabs__tab.is-active {
    border-bottom: 1px solid var(--neutral-950);
    margin-bottom: -1px;
  }

  .product-tabs__tab.is-active::after {
    display: none;
  }

  .product-tabs__content {
    display: none;
  }

  .product-tabs__content.is-active {
    display: block;
  }

  .product-tabs__description,
  .product-tabs__specifications,
  .product-tabs__shipping {
    color: var(--neutral-600);
  }

  .product-tabs__description > p {
    margin-bottom: var(--space-m);
  }

  .product-tabs__metafield {
    margin-bottom: var(--space-m);
  }

  .product-tabs__metafield h4 {
    margin-bottom: var(--space-xs);
    color: var(--neutral-950);
  }

  @media screen and (max-width: 1099px) {
    #product {
      flex-direction: column;
    }

    #product-details {
      width: 100%;
      height: auto;
      padding: var(--space-m);
    }

    .product-details__header {
      flex-direction: column;
      gap: var(--space-2xs);
      align-items: start;
    }

    .product-images-splide .splide__arrows {
      display: none;
    }

    .product-images-container--mobile .splide__arrows {
      display: block;
    }
  }
</style>

<script>
  var current_variant = {{ current_variant | json }};
  var variants = {{ product.variants | json }};
  var default_image = {{ product.featured_image.id | default: 'null' }};
</script>

<div class="section-wrap">
  <div id="product">
    <div class="product-images-container">
      <div class="splide product-images-splide">
        <div class="splide__arrows">
          <button class="splide__arrow splide__arrow--prev">
            <svg width="7" height="12" viewBox="0 0 7 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6 1L1 6L6 11" stroke="#0F0F0F" stroke-linecap="square"/>
            </svg>
          </button>
          <button class="splide__arrow splide__arrow--next">
            <svg width="7" height="12" viewBox="0 0 7 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 1L6 6L1 11" stroke="#0F0F0F" stroke-linecap="square"/>
            </svg>
          </button>
        </div>

        <div class="splide__track">
          <ul class="splide__list">
            {% if product.images.size == 0 %}
              <li class="splide__slide">
                {{ 'collection-4' | placeholder_svg_tag: 'placeholder' }}
              </li>
            {% endif %}
            {% for image in product.images %}
              {% assign image_width = 1024 %}
              {% assign image_height = image_width | divided_by: image.aspect_ratio | ceil %}
              <li class="splide__slide" data-imageid="{{ image.id }}">
                <img
                  src="{{ image.src | image_url: width: image_width }}"
                  srcset="
                    {{ image.src | image_url: width: 600 }} 600w,
                    {{ image.src | image_url: width: 800 }} 800w,
                    {{ image.src | image_url: width: 1024 }} 1024w,
                    {{ image.src | image_url: width: 1440 }} 1440w
                  "
                  sizes="(max-width: 768px) 100vw, 50vw"
                  width="{{ image_width }}"
                  height="{{ image_height }}"
                  alt="{{ image.alt }}"
                  loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
                  {% if forloop.first %}
                    fetchpriority="high"
                  {% endif %}
                  decoding="{% if forloop.first %}sync{% else %}async{% endif %}"
                >
              </li>
            {% endfor %}
          </ul>
        </div>

        <div class="product-images-progress">
          <div class="product-images-progress__bar"></div>
        </div>
      </div>
    </div>

    <section class="product-details__container custom-scrollbar">
      <div id="product-details">
        <div class="product-details__header">
          <h1 class="product-details__title heading--xl" data-title="{{ product.title }}">{{ product.title }}</h1>
          <div class="product-details__price">
            {% if current_variant.compare_at_price > current_variant.price %}
              <span class="product-details__compare-price body js--variant-compareatprice">
                {{ current_variant.compare_at_price | money }}
              </span>
            {% endif %}
            <span class="product-details__price-actual body js--variant-price">
              {{ current_variant.price | money }}
            </span>
          </div>
        </div>

        <p class="product-details__sku small">
          Product Code:
          <span class="js--variant-sku">{{ current_variant.sku }}</span>
        </p>

        <form action="{{ routes.cart_add_url }}" method="post">
          {%- for block in section.blocks -%}
            {% case block.type %}
              {%- when '@app' -%}
                {% render block %}

              {%- when 'options' %}
                {% unless product.has_only_default_variant %}
                  {% for option_group in product.options_with_values %}
                    {% assign option_field = option_group.position | prepend: 'option' %}
                    <fieldset class="variant-options js--variant-options">
                      <legend class="body--bold">{{ option_group.name }}:</legend>
                      <div class="variant-options__list">
                        {% for value in option_group.values %}
                          {% capture option_id %}{{ option_group.name }}_{{ value }}{% endcapture %}
                          <div class="variant-option">
                            <input
                              type="radio"
                              id="{{ option_id | handleize }}"
                              class="js--variant-option"
                              name="{{ option_group.position | prepend: 'option'}}"
                              value="{{ value }}"
                              {% if current_variant[option_field] == value %}
                                checked
                              {% endif %}
                            >
                            <label for="{{ option_id | handleize }}" class="body">
                              {{- value -}}
                            </label>
                          </div>
                        {% endfor %}
                      </div>
                    </fieldset>
                  {% endfor %}
                {% endunless %}

              {%- when 'button' -%}
                <input
                  type="hidden"
                  id="js--variant-id"
                  name="id"
                  value="{{ current_variant.id }}"
                >
                {% if current_variant.available == true %}
                  <button type="submit" id="js--addtocart" class="body">Add To Cart</button>
                {% else %}
                  <button type="submit" id="js--addtocart" class="body--uppercase" disabled>Unavailable</button>
                {% endif %}
            {%- endcase -%}
          {%- endfor -%}
        </form>

        {% assign has_description = false %}
        {% assign has_specs = false %}
        {% assign has_shipping = false %}

        {% if product.description != blank %}
          {% assign has_description = true %}
        {% endif %}

        {% if product.metafields.descriptors.care_guide != blank
          or product.metafields.custom.garment_fit != blank
          or product.metafields.custom.product_specifications != blank
        %}
          {% assign has_specs = true %}
        {% endif %}

        {% if section.settings.shipping_content != blank %}
          {% assign has_shipping = true %}
        {% endif %}

        {% if has_description or has_specs or has_shipping %}
          <div class="product-tabs">
            <div class="product-tabs__list">
              {% if has_description %}
                <button class="product-tabs__tab body--uppercase" data-tab="description">Product Info</button>
              {% endif %}
              {% if has_specs %}
                <button class="product-tabs__tab body--uppercase" data-tab="specs">Specifications And Care</button>
              {% endif %}
              {% if has_shipping %}
                <button class="product-tabs__tab body--uppercase" data-tab="shipping">Shipping</button>
              {% endif %}
            </div>

            {% if has_description %}
              <div class="product-tabs__content" data-content="description">
                <div class="product-tabs__description rte body">
                  {{ product.description }}
                </div>
              </div>
            {% endif %}

            {% if has_specs %}
              <div class="product-tabs__content" data-content="specs">
                {% if product.metafields.descriptors.care_guide != blank %}
                  <div class="product-tabs__metafield">
                    <h4 class="body--bold">Care Guide</h4>
                    <div class="body">{{ product.metafields.descriptors.care_guide }}</div>
                  </div>
                {% endif %}

                {% if product.metafields.custom.garment_fit != blank %}
                  <div class="product-tabs__metafield">
                    <h4 class="body--bold">Sizing Information</h4>
                    <div class="body">{{ product.metafields.custom.garment_fit }}</div>
                  </div>
                {% endif %}

                {% if product.metafields.custom.product_specifications != blank %}
                  <div class="product-tabs__metafield">
                    <h4 class="body--bold">Specifications</h4>
                    <div class="body">{{ product.metafields.custom.product_specifications }}</div>
                  </div>
                {% endif %}
              </div>
            {% endif %}

            {% if has_shipping %}
              <div class="product-tabs__content" data-content="shipping">
                <div class="body">
                  {{ section.settings.shipping_content }}
                </div>
              </div>
            {% endif %}
          </div>
        {% endif %}
      </div>
    </section>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const checkSplide = setInterval(function () {
      if (typeof Splide !== 'undefined') {
        clearInterval(checkSplide);
        initializeProductSlider();
      }
    }, 100);

    function initializeProductSlider() {
      let splideInstance = null;
      const container = document.querySelector('.product-images-container');
      const progressBar = document.querySelector('.product-images-progress__bar');

      function initSlider() {
        if (splideInstance) {
          splideInstance.destroy();
        }

        const isMobile = window.innerWidth < 1100;

        const options = isMobile
          ? {
              type: 'slide',
              arrows: true,
              perPage: 1,
              pagination: false,
              rewind: false,
              drag: true,
              speed: 300,
              waitForTransition: true,
            }
          : {
              direction: 'ttb',
              height: '100vh',
              wheel: true,
              waitForTransition: true,
              arrows: false,
              pagination: false,
              speed: 300,
              drag: true,
            };

        splideInstance = new Splide('.product-images-splide', options);

        splideInstance.on('mounted move', function () {
          const end = splideInstance.Components.Controller.getEnd() + 1;
          const rate = Math.min((splideInstance.index + 1) / end, 1);

          if (isMobile) {
            progressBar.style.width = String(100 * rate) + '%';
          } else {
            progressBar.style.height = String(100 * rate) + '%';
          }
        });

        splideInstance.mount();

        if (isMobile) {
          container.classList.add('product-images-container--mobile');
        } else {
          container.classList.remove('product-images-container--mobile');
        }

        const progress = document.querySelector('.product-images-progress');
        if (isMobile) {
          progress.classList.add('product-images-progress--mobile');
        } else {
          progress.classList.remove('product-images-progress--mobile');
        }
      }

      initSlider();

      let resizeTimeout;
      window.addEventListener('resize', function () {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(initSlider, 250);
      });
    }

    const tabButtons = document.querySelectorAll('.product-tabs__tab');
    const tabContents = document.querySelectorAll('.product-tabs__content');

    if (tabButtons.length > 0) {
      tabButtons.forEach((button) => {
        button.addEventListener('click', function () {
          const tabName = this.dataset.tab;

          tabButtons.forEach((tab) => tab.classList.remove('is-active'));
          tabContents.forEach((content) => content.classList.remove('is-active'));

          this.classList.add('is-active');
          const activeContent = document.querySelector(`[data-content="${tabName}"]`);

          if (activeContent) {
            activeContent.classList.add('is-active');
          }
        });
      });
    }
  });
</script>

{% schema %}
{
  "name": "Product Page",
  "tag": "section",
  "settings": [
    {
      "type": "richtext",
      "id": "shipping_content",
      "label": "Shipping Information",
      "default": "<p>Free shipping on orders over $100. Ships within 2-3 business days.</p>"
    }
  ],
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "options",
      "name": "Product options",
      "limit": 1,
      "settings": []
    },
    {
      "type": "prices",
      "name": "Prices",
      "settings": []
    },
    {
      "type": "button",
      "name": "Add to cart",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "button_label",
          "label": "Button Label",
          "default": "Add to cart"
        }
      ]
    }
  ]
}
{% endschema %}
