{% comment %}
  Collection Slider Header Section
{% endcomment %}

{{ 'section-collection-slider-header.css' | asset_url | stylesheet_tag }}

{% assign section_id = section.id %}
{% assign show_top_border = section.settings.show_top_border %}
{% assign show_bottom_border = section.settings.show_bottom_border %}
{% assign main_heading = section.settings.main_heading %}
{% assign subtitle = section.settings.subtitle %}
{% assign blocks = section.blocks %}

<div
  class="collection-slider-header"
  id="section-{{ section_id }}"
  style="{% if show_top_border %}border-top: 1px solid var(--neutral-50);{% endif %} {% if show_bottom_border %}border-bottom: 1px solid var(--neutral-50);{% endif %}"
>
  <div class="collection-slider-header__header">
    <div class="collection-slider-header__header-left">
      {% if main_heading != blank %}
        <h2 class="collection-slider-header__title heading--decorative">
          {{ main_heading }}
        </h2>
      {% endif %}

      <span class="collection-slider-header__divider"></span>

      {% if subtitle != blank %}
        <h3 class="collection-slider-header__subtitle heading--l">
          {{ subtitle }}
        </h3>
      {% endif %}
    </div>

    <nav class="collection-slider-header__nav custom-scrollbar">
      <ul class="collection-slider-header__nav-list">
        {% for block in blocks %}
          {% assign current_nav_label = block.settings.nav_label %}
          <li class="collection-slider-header__nav-item">
            <button
              class="collection-slider-header__nav-button body--uppercase {% if forloop.first %}active{% endif %}"
              data-index="{{ forloop.index0 }}"
            >
              {{ current_nav_label }}
            </button>
          </li>
        {% endfor %}
      </ul>
    </nav>
  </div>

  <div class="collection-slider-header__images-container">
    {% for block in blocks %}
      {% assign current_mobile_image = block.settings.mobile_image %}
      {% assign current_desktop_image = block.settings.desktop_image %}
      {% assign current_nav_label = block.settings.nav_label %}
      {% assign product_limit = block.settings.products_to_show | default: 10 %}

      <div
        class="collection-slider-header__image-wrapper {% if forloop.first %}active{% endif %}"
        data-image-index="{{ forloop.index0 }}"
      >
        <picture>
          {% if current_mobile_image != blank %}
            <source
              media="(max-width: 767px)"
              srcset="
                {{ current_mobile_image | image_url: width: 400 }} 1x,
                {{ current_mobile_image | image_url: width: 800 }} 2x
              "
            >
          {% endif %}

          {% if forloop.first %}
            {{
              current_desktop_image
              | image_url: width: 1920
              | image_tag:
                loading: 'eager',
                decoding: 'async',
                alt: current_nav_label,
                class: 'collection-slider-header__image',
                widths: '400, 600, 800, 1000, 1200, 1400, 1600, 1800, 2000, 2400, 3000',
                sizes: '(max-width: 400px) 400px, (max-width: 600px) 600px, (max-width: 800px) 800px, (max-width: 1000px) 1000px, (max-width: 1200px) 1200px, (max-width: 1400px) 1400px, (max-width: 1600px) 1600px, (max-width: 1800px) 1800px, (max-width: 2000px) 2000px, (max-width: 2400px) 2400px, 100vw'
            }}
          {% else %}
            {{
              current_desktop_image
              | image_url: width: 1920
              | image_tag:
                loading: 'lazy',
                decoding: 'async',
                alt: current_nav_label,
                class: 'collection-slider-header__image',
                widths: '400, 600, 800, 1000, 1200, 1400, 1600, 1800, 2000, 2400, 3000',
                sizes: '(max-width: 400px) 400px, (max-width: 600px) 600px, (max-width: 800px) 800px, (max-width: 1000px) 1000px, (max-width: 1200px) 1200px, (max-width: 1400px) 1400px, (max-width: 1600px) 1600px, (max-width: 1800px) 1800px, (max-width: 2000px) 2000px, (max-width: 2400px) 2400px, 100vw'
            }}
          {% endif %}
        </picture>
      </div>
    {% endfor %}
  </div>

  {% for block in blocks %}
    {% assign current_slider_heading = block.settings.slider_heading %}
    {% assign current_slider_description = block.settings.slider_description %}
    {% assign current_collection = block.settings.collection %}
    {% assign current_button_label = block.settings.button_label %}

    <div
      class="collection-slider-header__slider-section {% if forloop.first %}active{% endif %}"
      data-index="{{ forloop.index0 }}"
    >
      <div class="collection-slider-header__slider-container">
        <div class="collection-slider-header__slider-content">
          {% if current_slider_heading != blank %}
            <h2 class="heading--2xl collection-slider-header__slider-heading">
              {{ current_slider_heading }}
            </h2>
          {% endif %}

          {% if current_slider_description != blank %}
            <p class="body collection-slider-header__slider-description">
              {{ current_slider_description }}
            </p>
          {% endif %}

          {% if current_collection != blank and current_button_label != blank %}
            {% assign current_collection_url = block.settings.collection.url %}

            <a href="{{ current_collection_url }}" class="body collection-slider-header__slider-link">
              {{ current_button_label }}
              {% render '_icon-arrow-submit-dark' %}
            </a>
          {% endif %}
        </div>

        {% if current_collection != blank %}
          {% assign current_collection_products = block.settings.collection.products %}

          <div class="collection-slider-header__slider-wrapper">
            <div class="collection-slider-header__slider splide" id="slider-{{ section_id }}-{{ forloop.index0 }}">
              <div class="splide__arrows">
                <button class="splide__arrow splide__arrow--prev">{% render '_icon-arrow-see-less' %}</button>
                <button class="splide__arrow splide__arrow--next">{% render '_icon-arrow-see-more' %}</button>
              </div>
              <div class="splide__track">
                <div class="splide__list">
                  {% for product in current_collection_products limit: product_limit %}
                    {% assign product_title = product.title %}
                    {% assign product_url = product.url %}
                    {% assign product_fabric_description = product.metafields.custom.fabric_description %}
                    {% assign product_compare_at_price = product.compare_at_price %}
                    {% assign product_price = product.price %}
                    {% assign product_colour_variants = product.metafields.custom.product_colour_variants %}
                    {% assign featured_image = product.featured_image %}

                    <article class="splide__slide collection-slider-header__slide">
                      <a href="{{ product_url }}" class="collection-slider-header__product-link">
                        <div class="collection-slider-header__product-image-wrapper">
                          {% if featured_image != blank %}
                            {% assign featured_image_alt = product.featured_image.alt %}
                            {% assign featured_image_width = product.featured_image.width %}
                            {% assign featured_image_height = product.featured_image.height %}

                            <img
                              src="{{ featured_image | image_url: width: '600' }}"
                              alt="{{ featured_image_alt | escape }}"
                              loading="lazy"
                              width="{{ featured_image_width }}"
                              height="{{ featured_image_height }}"
                              class="collection-slider-header__product-image"
                              decoding="async"
                            >
                          {% else %}
                            {{
                              'product-1'
                              | placeholder_svg_tag: 'collection-slider-header__product-image placeholder'
                            }}
                          {% endif %}
                        </div>

                        <h3 class="body--bold collection-slider-header__product-title">{{ product_title }}</h3>

                        {% if product_fabric_description != blank %}
                          <p class="small collection-slider-header__product-material">
                            {{ product_fabric_description }}
                          </p>
                        {% endif %}

                        <p class="small collection-slider-header__product-price">
                          {% if product_compare_at_price > product_price %}
                            <span class="collection-slider-header__product-price--sale">
                              {{- product_price | money_with_currency -}}
                            </span>
                            <span class="collection-slider-header__product-price--compare">
                              Was
                              {{ product_compare_at_price | money_with_currency -}}
                            </span>
                          {% else %}
                            {{ product_price | money_with_currency }}
                          {% endif %}
                        </p>
                      </a>

                      {% if product_colour_variants %}
                        {% assign colour_variants = product.metafields.custom.product_colour_variants.value %}
                        {% assign max_display = 3 %}
                        {% assign remaining_count = colour_variants.count | minus: max_display %}
                        {% assign current_colour = product.metafields.custom.swatch_colour.value.colour | strip %}
                        {% assign bg_colour = current_colour | default: 'var(--neutral-200)' %}
                        {% assign border_style = '1px solid var(--neutral-950)' %}

                        <div class="product-card__swatches">
                          <a
                            href="{{ product_url }}"
                            class="product-card__swatch-link"
                            aria-label="View {{ product_title }} variant"
                            style="border: {{ border_style }}; background-color: {{ bg_colour }}; padding: 2px; background-clip: content-box;"
                          >
                          </a>

                          {% for variant in colour_variants limit: max_display %}
                            {% assign variant_title = variant.title %}
                            {% assign variant_url = variant.url %}
                            {% assign variant_colour = variant.metafields.custom.swatch_colour.value.colour | strip %}
                            {% assign variant_name = variant.metafields.custom.swatch_colour.value.name | strip %}
                            {% assign bg_colour = variant_colour | default: 'var(--neutral-200)' %}

                            {% if variant_name == 'White' %}
                              {% assign border_style = '2px solid var(--neutral-200)' %}
                            {% else %}
                              {% assign border_colour = variant_colour | default: 'var(--neutral-950)' %}
                              {% assign border_style = '2px solid ' | append: border_colour %}
                            {% endif %}

                            <a
                              href="{{ variant_url }}"
                              class="product-card__swatch-link"
                              aria-label="View {{ variant_title }} variant"
                              style="border: {{ border_style }}; background-color: {{ bg_colour }};"
                            >
                            </a>
                          {% endfor %}

                          {% if remaining_count > 0 %}
                            <p class="small">+{{ remaining_count }}</p>
                          {% endif %}
                        </div>
                      {% endif %}
                    </article>
                  {% endfor %}
                </div>
              </div>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  {% endfor %}
</div>

<script
  src="{{ "section-collection-slider-header.js" | asset_url }}"
  data-section-id="{{ section.id }}"
  defer
></script>

{% schema %}
{
  "name": "Collection Slider Header",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "main_heading",
      "label": "Main Heading",
      "default": "New Collections"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "Seasonal Favorites"
    },
    {
      "type": "checkbox",
      "id": "show_top_border",
      "label": "Show top border",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_bottom_border",
      "label": "Show bottom border",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "navigation_item",
      "name": "Navigation Item",
      "limit": 5,
      "settings": [
        {
          "type": "text",
          "id": "nav_label",
          "label": "Navigation Label",
          "default": "Collection Name"
        },
        {
          "type": "image_picker",
          "id": "desktop_image",
          "label": "Desktop Image"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "Mobile Image (optional)"
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },
        {
          "type": "text",
          "id": "slider_heading",
          "label": "Slider Heading",
          "default": "New In Now"
        },
        {
          "type": "textarea",
          "id": "slider_description",
          "label": "Slider Description",
          "default": "Layer up with premium wool/cashmere blends."
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Button Label",
          "default": "Shop Now"
        },
        {
          "type": "range",
          "id": "products_to_show",
          "min": 3,
          "max": 12,
          "step": 1,
          "default": 10,
          "label": "Maximum products to show"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Collection Slider Header",
      "category": "Collection",
      "blocks": [
        {
          "type": "navigation_item",
          "settings": {
            "nav_label": "New Arrivals",
            "slider_heading": "New Arrivals"
          }
        },
        {
          "type": "navigation_item",
          "settings": {
            "nav_label": "Suits",
            "slider_heading": "Suits Collection"
          }
        }
      ]
    }
  ],
  "enabled_on": {
    "templates": ["index", "page", "article", "blog"]
  }
}
{% endschema %}
