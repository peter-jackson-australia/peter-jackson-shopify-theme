<div class="product-card">
  <a class="product-card__image-link" href="{{ product.url }}">
    <div
      class="product-card__image-wrapper"
      x-data="
        {
          isHovering: false,
          splideInstance: null,
          initSplide() {
            if (!this.splideInstance && this.isHovering) {
              this.$nextTick(() => {
                this.splideInstance = new Splide(this.$refs.splide, {
                  type: 'fade',
                  arrows: true,
                  pagination: false,
                  speed: 400
                }).mount();
              });
            }
          },
          destroySplide() {
            if (this.splideInstance) {
              this.splideInstance.destroy();
              this.splideInstance = null;
            }
          }
        }
      "
      @mouseenter="isHovering = true; initSplide()"
      @mouseleave="isHovering = false; destroySplide()"
    >
      {% if product.featured_image == blank %}
        {{ 'product-1' | placeholder_svg_tag: 'product-card__image placeholder' }}
      {% else %}
        <div x-bind:class="{ 'opacity-0': isHovering }">
          {% comment %}
            Check if this is among the first two products to render
            If used in a section, use section.index instead of forloop.index0
          {% endcomment %}

          {% assign image_class = 'product-card__image' %}
          {% assign image_alt = product.featured_image.alt | escape | strip_html | strip_newlines %}

          {%- if forloop.index0 != blank and forloop.index0 < 2 -%}
            {{
              product.featured_image
              | image_url: width: image_width
              | image_tag: alt: image_alt, loading: 'eager', preload: true
            }}
          {%- else -%}
            {{ product.featured_image | image_url: width: image_width | image_tag: alt: image_alt, loading: 'eager' }}
          {%- endif -%}
        </div>
      {% endif %}

      <div
        class="product-card__slider-wrapper"
        x-show="isHovering"
        x-cloak
      >
        <div class="splide product-card__slider" x-ref="splide">
          <div class="splide__track">
            <ul class="splide__list">
              {% for image in product.images %}
                <li class="splide__slide">
                  {% assign image_alt = image.alt | escape | strip_html | strip_newlines %}
                  {{
                    image
                    | image_url: width: image_width
                    | image_tag: class: 'product-card__image', width: image_width, height: image_height, alt: image_alt
                  }}
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
    </div>
  </a>

  <div class="product-card__content">
    <a href="{{ product.url }}" class="product-card__title-link">
      <h3 class="product-card__title">{{ product.title }}</h3>
    </a>

    {% if product.metafields.custom.fabric_description != blank %}
      <p class="product-card__material">
        {{ product.metafields.custom.fabric_description }}
      </p>
    {% endif %}

    <p class="product-card__price">
      {% if product.compare_at_price > product.price %}
        <span class="product-card__price--compare">{{ product.compare_at_price | money }}</span>
      {% endif %}
      <span class="product-card__price--current">{{ product.price | money }}</span>
    </p>
  </div>
</div>
