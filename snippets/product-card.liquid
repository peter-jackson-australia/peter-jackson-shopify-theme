{% comment %}
  Product Card
{% endcomment %}

{% assign image_width = image_width %}
{% assign image_height = image_height %}
{% assign image_alt = product.featured_image.alt | escape | strip_html | strip_newlines | default: product.title %}

<div class="product-card">
  <a class="product-card__image-link" href="{{ product.url }}">
    <div
      class="product-card__image-wrapper"
      {% if product.images.size > 1 %}
        x-data="
          {
            isHovering: false,
            splideInstance: null
          }
        "
        @mouseenter="
          isHovering = true;
          $nextTick(() => {
            if (!splideInstance && window.Splide) {
              const sliderHTML = `
                <div class='product-card__slider-wrapper'>
                  <div class='splide product-card__slider'>
                    <div class='splide__track'>
                      <ul class='splide__list'>
                        {% for image in product.images %}
                          <li class='splide__slide'>
                            <img
                              src='{{ image | image_url: width: image_width, height: image_height }}'
                              alt='{{ image.alt | escape | default: product.title }}'
                              class='product-card__image'
                              width='{{ image_width }}'
                              height='{{ image_height }}'
                              loading='lazy'
                            >
                          </li>
                        {% endfor %}
                      </ul>
                    </div>
                  </div>
                </div>
              `;
              $refs.sliderContainer.innerHTML = sliderHTML;
              splideInstance = new Splide($refs.sliderContainer.querySelector('.splide'), {
                type: 'fade',
                arrows: true,
                pagination: false,
                speed: 400
              }).mount();
            }
          })
        "
        @mouseleave="isHovering = false; if (splideInstance) { splideInstance.destroy(); splideInstance = null; $refs.sliderContainer.innerHTML = ''; }"
      {% endif %}
    >
      <div>
        {{
          product.featured_image
          | image_url: width: image_width, height: image_height
          | image_tag:
            class: 'product-card__image',
            width: image_width,
            height: image_height,
            alt: image_alt,
            loading: 'eager'
        }}
      </div>

      {% if product.images.size > 1 %}
        <div
          x-ref="sliderContainer"
          x-show="isHovering"
          x-transition:enter="transition ease-out duration-200"
          x-transition:enter-start="opacity-0"
          x-transition:enter-end="opacity-100"
        ></div>
      {% endif %}
    </div>
  </a>

  <div class="product-card__content">
    <a href="{{ product.url }}" class="product-card__title-link">
      <h2 class="product-card__title body--bold">{{ product.title }}</h2>
    </a>

    {% if product.metafields.custom.fabric_description != blank %}
      <p class="product-card__material small">
        {{ product.metafields.custom.fabric_description }}
      </p>
    {% endif %}

    <p class="product-card__price small">
      <span class="product-card__price--current">{{ product.price | money }}</span>
      <span class="product-card__price--compare">{{ product.compare_at_price | money }}</span>
    </p>
  </div>
</div>
