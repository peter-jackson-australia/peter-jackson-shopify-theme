{% comment %}
Auto-generated by Shogun-AB.
This file can be re-written at any time.
{% endcomment %}


{% if article %}
  {% assign content = article %}
{% elsif blog %}
  {% assign content = blog %}
{% elsif page %}
  {% assign content = page %}
{% elsif product %}
  {% assign content = product %}
{% elsif collection %}
  {% assign content = collection %}
{% elsif metaobject %}
  {% assign content = metaobject.system %}
{% endif %}

<script type="text/javascript">
  var W=Object.defineProperty;var q=(f,m,p)=>m in f?W(f,m,{enumerable:!0,configurable:!0,writable:!0,value:p}):f[m]=p;var c=(f,m,p)=>q(f,typeof m!="symbol"?m+"":m,p);(function(){"use strict";var f=" daum[ /]| deusu/| yadirectfetcher|(?:^|[^g])news(?!sapphire)|(?<! (?:channel/|google/))google(?!(app|/google| pixel))|(?<! cu)bots?(?:\\b|_)|(?<!(?:lib))http|(?<![hg]m)score|(?<!cam)scan|@[a-z][\\w-]+\\.|\\(\\)|\\.com\\b|\\btime/|\\||^<|^[\\w \\.\\-\\(?:\\):%]+(?:/v?\\d+(?:\\.\\d+)?(?:\\.\\d{1,10})*?)?(?:,|$)|^[^ ]{50,}$|^\\d+\\b|^\\w*search\\b|^\\w+/[\\w\\(\\)]*$|^active|^ad muncher|^amaya|^avsdevicesdk/|^biglotron|^bot|^bw/|^clamav[ /]|^client/|^cobweb/|^custom|^ddg[_-]android|^discourse|^dispatch/\\d|^downcast/|^duckduckgo|^email|^facebook|^getright/|^gozilla/|^hobbit|^hotzonu|^hwcdn/|^igetter/|^jeode/|^jetty/|^jigsaw|^microsoft bits|^movabletype|^mozilla/\\d\\.\\d\\s[\\w\\.-]+$|^mozilla/\\d\\.\\d\\s\\(compatible;?(?:\\s\\w+\\/\\d+\\.\\d+)?\\)$|^navermailapp|^netsurf|^offline|^openai/|^owler|^php|^postman|^python|^rank|^read|^reed|^rest|^rss|^snapchat|^space bison|^svn|^swcd |^taringa|^thumbor/|^track|^w3c|^webbandit/|^webcopier|^wget|^whatsapp|^wordpress|^xenu link sleuth|^yahoo|^yandex|^zdm/\\d|^zoom marketplace/|^{{.*}}$|analyzer|archive|ask jeeves/teoma|audit|bit\\.ly/|bluecoat drtr|browsex|burpcollaborator|capture|catch|check\\b|checker|chrome-lighthouse|chromeframe|classifier|cloudflare|convertify|crawl|cypress/|dareboost|datanyze|dejaclick|detect|dmbrowser|download|evc-batch/|exaleadcloudview|feed|firephp|functionize|gomezagent|grab|headless|httrack|hubspot marketing grader|hydra|ibisbrowser|infrawatch|insight|inspect|iplabel|ips-agent|java(?!;)|library|linkcheck|mail\\.ru/|manager|measure|neustar wpm|node|nutch|offbyone|onetrust|optimize|pageburst|pagespeed|parser|perl|phantomjs|pingdom|powermarks|preview|proxy|ptst[ /]\\d|retriever|rexx;|rigor|rss\\b|scrape|server|sogou|sparkler/|speedcurve|spider|splash|statuscake|supercleaner|synapse|synthetic|tools|torrent|transcoder|url|validator|virtuoso|wappalyzer|webglance|webkit2png|whatcms/|xtate/",m=/bot|crawl|http|lighthouse|scan|search|spider/i,p;function D(){if(p instanceof RegExp)return p;try{p=new RegExp(f,"i")}catch{p=m}return p}function k(s){return!!s&&D().test(s)}/*! js-cookie v3.0.5 | MIT */function w(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)s[i]=t[i]}return s}var P={read:function(s){return s[0]==='"'&&(s=s.slice(1,-1)),s.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(s){return encodeURIComponent(s).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function S(s,e){function t(r,n,a){if(!(typeof document>"u")){a=w({},e,a),typeof a.expires=="number"&&(a.expires=new Date(Date.now()+a.expires*864e5)),a.expires&&(a.expires=a.expires.toUTCString()),r=encodeURIComponent(r).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var d in a)a[d]&&(o+="; "+d,a[d]!==!0&&(o+="="+a[d].split(";")[0]));return document.cookie=r+"="+s.write(n,r)+o}}function i(r){if(!(typeof document>"u"||arguments.length&&!r)){for(var n=document.cookie?document.cookie.split("; "):[],a={},o=0;o<n.length;o++){var d=n[o].split("="),g=d.slice(1).join("=");try{var h=decodeURIComponent(d[0]);if(a[h]=s.read(g,h),r===h)break}catch{}}return r?a[r]:a}}return Object.create({set:t,get:i,remove:function(r,n){t(r,"",w({},n,{expires:-1}))},withAttributes:function(r){return S(this.converter,w({},this.attributes,r))},withConverter:function(r){return S(w({},this.converter,r),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(s)}})}var z=S(P,{path:"/"});const A=s=>{const e=window.innerWidth<768||window.outerWidth<768?"mobile":"desktop";return s===e},O=(s,e)=>{const t=!!e,i=String(s)==="true";return t===i},I="shg_geo_data";function C(s,e){const t=s-e;return Math.floor(t/(1e3*60*60*24))}function U(){if(new URLSearchParams(window.location.search).get("shg_geo_cache")==="false")return null;let e=null;try{const t=localStorage.getItem(I);if(t){const i=JSON.parse(t),r=Date.now();i.timestamp&&C(r,i.timestamp)<=7?e=i:localStorage.removeItem(I)}}catch(t){return console.error("Error reading geo data from cache:",t),localStorage.removeItem(I),null}return e}function M(s){let e=null;if(!s)return console.warn("Geo location API URL not configured."),e;try{const t=new XMLHttpRequest;t.open("GET",s,!1),t.send(null),t.status===200?(e=JSON.parse(t.responseText),e?(e.timestamp=Date.now(),localStorage.setItem(I,JSON.stringify(e))):(console.error("Geo API response parsed to null or undefined."),e=null)):console.error(`Geo API request failed with status: ${t.status}`)}catch(t){console.error("Error fetching geo data from API:",t)}return e}function L(s){let e=null;try{const t=U();t?(e=t,console.debug("Loaded geo data from cache:",e)):(e=M(s),console.debug("Fetched geo data from API:",e))}catch(t){console.error("Error initializing geo data:",t),e=null}return e}const F=(s,e)=>{const{type:t,countryCode:i,toponymName:r,parentName:n}=s||{},{country:a,region:o,city:d}=e||{};if(!t||!i||!e)return!1;switch(t){case"country":return a===i;case"region":return o===r&&a===i;case"city":return d===r&&o===n&&a===i;default:return console.debug("Unknown location type:",t),!1}},B=s=>typeof s!="string"?!1:document.referrer.toLowerCase().includes(s.toLowerCase()),N=s=>typeof s!="string"?!1:window.location.href.toLowerCase().includes(s.toLowerCase()),G=(s,e,t)=>{if(!e)return!1;const{expectedTimeInMillseconds:i,withinOrAfter:r}=s||{};if(typeof i!="number"||!r)return!1;const n=e.first_visit_timestamp;return r==="within"?n+i>t:n+i<t},$=(s,e,t)=>e?t-e.first_visit_timestamp<18e5===s:s===!0;function j(s,e){return s===e}const v=class v{constructor(e){c(this,"visitorDetails",null);c(this,"currentTime");c(this,"geoLocationApi");c(this,"customerId");c(this,"isB2B");c(this,"internalGeoData");c(this,"isGeoDataInitialized",!1);c(this,"checkers",{device:e=>A(e),logged_in:(e,t)=>O(e,this.customerId),new_visitor:(e,t)=>$(e,t.visitorDetails,t.currentTime),returning_visitor:(e,t)=>G(e,t.visitorDetails,t.currentTime),url_contains:e=>N(e),referrer_contains:e=>B(e),location:(e,t)=>F(e,t.geoData),b2b:e=>j(e,this.isB2B)});this.geoLocationApi=e.geoLocationApi,this.customerId=e.customerId,this.isB2B=e.isB2B,this.currentTime=Date.now(),this.initializeVisitorDetails()}initializeVisitorDetails(){var e;try{const t=localStorage.getItem(v.VISITOR_DETAILS_KEY);t&&(this.visitorDetails=JSON.parse(t),typeof((e=this.visitorDetails)==null?void 0:e.first_visit_timestamp)!="number"&&(console.warn("Invalid visitor details found in storage, resetting."),this.visitorDetails=null)),this.visitorDetails===null?(console.debug("Initializing new visitor details."),this.visitorDetails={first_visit_timestamp:this.currentTime},localStorage.setItem(v.VISITOR_DETAILS_KEY,JSON.stringify(this.visitorDetails))):console.debug("Loaded visitor details from storage:",this.visitorDetails)}catch(t){console.error("Error initializing visitor details:",t),localStorage.removeItem(v.VISITOR_DETAILS_KEY),this.visitorDetails={first_visit_timestamp:this.currentTime},localStorage.setItem(v.VISITOR_DETAILS_KEY,JSON.stringify(this.visitorDetails))}}check(e){const t=this.checkers[e.audience_type];if(!t)return console.warn(`Unknown audience type: ${e.audience_type}`),!1;e.audience_type==="location"&&!this.isGeoDataInitialized&&(console.debug("Location check required, initializing geoData..."),this.internalGeoData=L(this.geoLocationApi),this.isGeoDataInitialized=!0,console.debug("GeoData initialization result:",this.internalGeoData));const i={geoData:this.internalGeoData===void 0?null:this.internalGeoData,visitorDetails:this.visitorDetails,currentTime:this.currentTime};try{const r=!!t(e.value,i);return console.debug("Audience check result:",{audience:e,internalContext:i,matched:r}),e.condition==="is_not"?!r:r}catch(r){return console.error("Error during audience check:",{audience:e,internalContext:i,error:r}),!1}}};c(v,"VISITOR_DETAILS_KEY","_shg_ab_visitor_details");let V=v;class x{constructor(e){this.trackingService=e}extractViewParamFromFullTemplateKey(e){const t=e.split("/").pop().split(".");return t.slice(1,t.length-1).join(".")}async handleRedirect(e){const t=new URL(window.location.href),i=new URL(window.location.href);if(e.optimization.scope=="price")i.searchParams.set("preview_theme_id",e.optimization.config.theme_id);else if(e.optimization.scope==="theme")i.searchParams.set("preview_theme_id",e.selectedVariant.config.theme_id);else if(e.optimization.scope==="url_redirect")i.pathname=e.languageRootUrl!=="/"?e.languageRootUrl+e.selectedVariant.config.path:e.selectedVariant.config.path;else{const r=this.extractViewParamFromFullTemplateKey(e.selectedVariant.config.full_template_key);i.searchParams.set("view",r)}t.toString()===i.toString()?this.hideViewParam():this.redirectWithoutCache(i)}hideViewParam(){const e=new URL(window.location.href);e.searchParams.delete("view"),window.history.replaceState({},"",e.toString())}dispatch(e,t){if(e[0].optimization.scope=="price"){const i=e[0];if(t)console.debug("shogun: price variant already assigned, returning");else{const r=e[0].selectedVariant.id;console.debug("shogun: assigning price variant");const n=JSON.stringify({attributes:{shogun_variant_id:r}}),a=new XMLHttpRequest;a.open("POST","/cart/update.js",!0),a.setRequestHeader("Content-Type","application/json"),a.onreadystatechange=()=>{if(a.readyState==4&&a.status==200)return console.debug("shogun: reloading to reflect cart pricing"),this.handleRedirect(i)},a.send(n)}}else{const i=e.find(n=>n.matchingVariant.id!==n.selectedVariant.id);if(console.debug("redirectingSelection",i),i&&(i.optimization.scope!=="url_redirect"||i.isFirstAssignment===!0||i.optimization.config.permanent_redirect===!0))return this.handleRedirect(i);const r=new Set(e.map(n=>n.optimization.scope));(r.has("template")||r.has("page"))&&this.hideViewParam()}e.filter(i=>i.current()).forEach(i=>{this.trackingService.trackVariantImpression(i.selectedVariant,i.optimization.type)})}redirectWithoutCache(e){typeof e=="string"&&(e=new URL(e)),e.searchParams.delete("cache"),document.referrer!=""&&sessionStorage.setItem(R,document.referrer),console.debug("shogun: redirecting to ",e),window.location.replace(e)}}class b{constructor(e){c(this,"optimization");c(this,"matchingVariant");c(this,"selectedVariant");c(this,"isFirstAssignment");c(this,"languageRootUrl");this.optimization=e.optimization,this.matchingVariant=e.matchingVariant,this.selectedVariant=e.selectedVariant,this.isFirstAssignment=e.isFirstAssignment,this.languageRootUrl=e.languageRootUrl}current(){return this.matchingVariant.id===this.selectedVariant.id}}const y=class y{constructor(){c(this,"ran",!1)}removePreviewBarIframe(){console.debug("Setting up preview bar iframe removal");const e=()=>{y.PREVIEW_BAR_IFRAME_IDS.forEach(t=>{const i=document.getElementById(t);i&&(console.debug(`Removing preview bar iframe with id: ${t}`),i.remove())})};e(),document.addEventListener("DOMContentLoaded",()=>{console.debug("DOM loaded, setting up mutation observer for preview bar");const t=new MutationObserver(i=>{i.forEach(r=>{r.addedNodes.forEach(n=>{if(n.nodeType===Node.ELEMENT_NODE){const a=n;y.PREVIEW_BAR_IFRAME_IDS.includes(a.id)&&(console.debug(`Detected and removing preview bar iframe with id: ${a.id} via observer`),a.remove())}})})});if(document.body)t.observe(document.body,{childList:!0,subtree:!0});else{const i=new MutationObserver(()=>{document.body&&(t.observe(document.body,{childList:!0,subtree:!0}),e(),i.disconnect())});i.observe(document.documentElement,{childList:!0})}e()})}run(){this.ran||(this.removePreviewBarIframe(),this.ran=!0)}};c(y,"PREVIEW_BAR_IFRAME_IDS",["preview-bar-iframe","PBarNextFrameWrapper"]);let T=y;class K{constructor(e,t,i,r,n,a){this.shopId=e,this.pageType=t,this.pageId=i,this.originalReferrer=r,this.analyticsUrl=n,this.dispatcherSessionId=a}shogunLoaded(e){let t,i=0;const r=4*30,n=()=>{var a,o;try{(o=(a=window.Shopify)==null?void 0:a.analytics)!=null&&o.publish?(console.debug("Firing shogun:load event",e),window.Shopify.analytics.publish("shogun:load",e)):i<=r?(console.debug("Shopify analytics not available to publish shogun:load event, retrying in 250ms"),i+=1,t=setTimeout(n,250)):(console.warn("Shopify analytics not available after 30s!"),this.trackDispatchFallback("errored",{shop_id:this.shopId,dispatcher_session_id:this.dispatcherSessionId,optimization_id:e.optimization_id,variant_id:e.variant_id,details:{error:"Error publishing shogun:load event: Shopify analytics not available after 30s"}}))}catch(d){console.error("Error publishing shogun:load event:",d),this.trackDispatchFallback("errored",{shop_id:this.shopId,dispatcher_session_id:this.dispatcherSessionId,optimization_id:e.optimization_id,variant_id:e.variant_id,details:{error:`Error publishing shogun:load event: ${d.message}`}})}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n()}trackVariantImpression(e,t){const i={page_type:this.pageType,page_id:this.pageId,app_type:t=="ab_test"?"ab_testing":"personalization",original_referrer:this.originalReferrer};i.optimization_id=e.optimization_id,i.variant_id=e.id,console.debug(`Tracking variant impression: optimization=${e.optimization_id}, variant=${e.id}`),this.shogunLoaded(i)}trackPage(){const e={page_type:this.pageType,page_id:this.pageId,app_type:"ab_testing"};this.shogunLoaded(e)}trackDispatch(e,t){let i,r=0;const n=4*30,a=`shogun:dispatcher:${e}`,o=()=>{var d,g;try{(g=(d=window.Shopify)==null?void 0:d.analytics)!=null&&g.publish?(console.debug(`Firing ${a} event`,t),window.Shopify.analytics.publish(a,t)):r<=n?(console.debug(`Shopify analytics not available to publish ${a} event, retrying in 250ms`),r+=1,i=setTimeout(o,250)):(console.warn("Shopify analytics not available after 30s!"),t.shop_id=this.shopId,t.dispatcher_session_id=this.dispatcherSessionId,t.details.error=`Error publishing ${a} event: Shopify analytics not available after 30s`,this.trackDispatchFallback(e,t))}catch(h){console.error(`Error publishing ${a} event:`,h),t.shop_id=this.shopId,t.dispatcher_session_id=this.dispatcherSessionId,t.details.error=`Error publishing ${a} event: ${h.message}`,this.trackDispatchFallback(e,t)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o):o()}trackDispatchFallback(e,t){fetch(`${this.analyticsUrl}/dispatcher/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),keepalive:!0})}}const R="_shg_referrer",l=class l{constructor(e){c(this,"shopId");c(this,"cacheEnabled");c(this,"optimizations");c(this,"currentThemeId");c(this,"pageId");c(this,"pageType");c(this,"currentPartialTemplateKey");c(this,"distributionMethod");c(this,"cachedOptimizations");c(this,"audienceChecker");c(this,"personalizations");c(this,"abTests");c(this,"dispatcher");c(this,"trackingService");c(this,"currentPath");c(this,"themeTestHandler");c(this,"currentPricingVariantId");c(this,"languageRootUrl");c(this,"dispatcherSessionId");c(this,"originalReferrer");c(this,"inAudience",e=>this.audienceChecker.check(e));if(this.originalReferrer=sessionStorage.getItem(R),this.originalReferrer){sessionStorage.removeItem(R),console.debug("shogun: retaining original referrer: ",this.originalReferrer);try{Object.defineProperty(document,"referrer",{get:()=>this.originalReferrer})}catch(a){console.debug("shogun: failed to set original referrer via `Object.defineProperty`"),console.error(a);try{window.document.__defineGetter__("referrer",()=>this.originalReferrer)}catch(o){console.debug("shogun: failed to set original referrer via `__defineGetter__`"),console.error(o)}}}this.shopId=e.shopId,this.currentThemeId=e.currentThemeId,this.currentPricingVariantId=e.currentPricingVariantId;const t=e.optimizations||[];e.defaultThemeId!==this.currentThemeId?this.optimizations=t.filter(a=>a.scope==="price"||a.variants.some(o=>o.config.theme_id===this.currentThemeId)):this.optimizations=t,this.personalizations=this.optimizations.filter(a=>a.type==="personalization"),this.abTests=this.optimizations.filter(a=>a.type==="ab_test"),this.distributionMethod=e.distributionMethod||l.DEFAULT_DISTRIBUTION_METHOD,this.pageId=e.pageId,this.pageType=e.pageType,this.cacheEnabled=e.cacheEnabled,this.languageRootUrl=e.languageRootUrl;const i=this.pageType==="metaobject"?"templates/metaobject/":"templates/",r=[e.templateName,e.templateSuffix].filter(Boolean).join(".");this.currentPartialTemplateKey=i+r,this.currentPath=window.location.pathname,this.cachedOptimizations=JSON.parse(localStorage.getItem(l.OPTIMIZATIONS_CACHE_KEY)||"{}"),this.audienceChecker=new V(e),e.sessionIdOverride?this.dispatcherSessionId=e.sessionIdOverride:(this.dispatcherSessionId=z.get(l.DISPATCHER_SESSION_COOKIE)||crypto.randomUUID(),z.set(l.DISPATCHER_SESSION_COOKIE,this.dispatcherSessionId,{path:"/",expires:1/48})),this.trackingService=new K(this.shopId,this.pageType,this.pageId,this.originalReferrer,e.analyticsUrl,this.dispatcherSessionId);const n=new T;this.themeTestHandler=n,this.dispatcher=new x(this.trackingService)}getOptimizationPriority(e){return{theme:1,template:2,page:3,url_redirect:4,price:5}[e.scope]}sortMatches(e){return[...e].sort((t,i)=>{const r=this.getOptimizationPriority(t.optimization),n=this.getOptimizationPriority(i.optimization);return r===n?0:r-n})}audienceMatchesCurrentVisitor(e){const t=e.audiences||[];return t.length===0?!0:e.audiences_condition==="any"?t.some(this.inAudience):t.every(this.inAudience)}configAudiencesMatch(e,t){const i=e.audiences||[],r=t.audiences||[];if(i.length!==r.length)return!1;const n=i.map(o=>JSON.stringify(o)),a=r.map(o=>JSON.stringify(o));return!(n.some(o=>!a.includes(o))||a.some(o=>!n.includes(o))||i.length>1&&e.audiences_condition!==t.audiences_condition)}getCachedVariant(e){if(!this.cacheEnabled)return;const t=this.cachedOptimizations[e.id];if(t)return e.variants.find(i=>i.id===t)}setCachedVariant(e,t){this.cachedOptimizations[e.id]=t.id,console.debug("setCachedVariant",e.id,t.id),localStorage.setItem(l.OPTIMIZATIONS_CACHE_KEY,JSON.stringify(this.cachedOptimizations))}extractPartialTemplateKeyFromFullTemplateKey(e){if(!e)return;const t=e.split(".");return t.length<2?e:t.slice(0,-1).join(".")}matchesAnyAttributeOfCurrentPage(e,t){const i=e.config.page_id,r=e.config.page_type,n=this.extractPartialTemplateKeyFromFullTemplateKey(t.config.full_template_key),a=t.config.theme_id,o=t.config.path,d=n===this.currentPartialTemplateKey,g=a===this.currentThemeId,h=this.languageRootUrl!=="/"&&this.currentPath.startsWith(this.languageRootUrl)?this.currentPath.substring(this.languageRootUrl.length)||"/":this.currentPath,_=o&&decodeURIComponent(o)===decodeURIComponent(h),u=e.scope==="price"&&(!this.currentPricingVariantId||this.currentPricingVariantId===t.id),H=!r||r===this.pageType,J=!i||i===this.pageId,Y=e.scope!=="url_redirect"&&H&&J;return g||d&&Y||_||u}getMatchingVariant(e,t=void 0){var n;const i=e.config,r=(n=t==null?void 0:t.selectedVariant)==null?void 0:n.config;for(const a of e.variants){if(!this.matchesAnyAttributeOfCurrentPage(e,a))continue;const o=e.type==="ab_test"?e.config:a.config;if(this.audienceMatchesCurrentVisitor(o)&&!(r&&!this.configAudiencesMatch(i,r)))return a}}getPersonalizationMatches(){const e=[];for(const t of this.personalizations){const i=this.getMatchingVariant(t);i&&e.push({optimization:t,matchingVariant:i})}return e}getPrioritizedNonDefaultPersonalizationSelection(){const e=this.getPersonalizationMatches();if(e.length===0)return;const t=this.sortMatches(e);for(const i of t){const n=i.optimization.variants.sort((a,o)=>a.position-o.position).find(a=>!a.config.original&&this.audienceMatchesCurrentVisitor(a.config));if(n)return new b({optimization:i.optimization,matchingVariant:i.matchingVariant,selectedVariant:n,languageRootUrl:this.languageRootUrl})}}getDefaultPersonalizationSelectionsForImpressionTracking(e){return this.getPersonalizationMatches().filter(r=>r.matchingVariant.config.original&&r.optimization.id!==(e==null?void 0:e.optimization.id)).map(r=>new b({optimization:r.optimization,matchingVariant:r.matchingVariant,selectedVariant:r.matchingVariant,languageRootUrl:this.languageRootUrl}))}getCryptoRandom(){const e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]/2**32}getRandomInt(e){const t=new Uint32Array(1);return crypto.getRandomValues(t),t[0]%e}getRandomVariantForOptimization(e){const t=this.getCryptoRandom();let i=0;for(const n of e.variants){const a=(n.config.percentage||0)/100,o=i+a;if(t>=i&&t<o)return n;i=o}const r=this.getRandomInt(e.variants.length);return e.variants[r]}hasAnyCachedVariants(){return this.cacheEnabled===!1?!1:this.abTests.some(e=>!!this.cachedOptimizations[e.id])}getGreedySelections(e){const t=e[Math.floor(Math.random()*e.length)],i=t.cachedVariant||this.getRandomVariantForOptimization(t.optimization);return[new b({optimization:t.optimization,matchingVariant:t.matchingVariant,selectedVariant:i,isFirstAssignment:!t.cachedVariant,languageRootUrl:this.languageRootUrl})]}userBin(){const e=this.dispatcherSessionId;let t=0;if(!e)return 0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return Math.abs(t)%l.DEFAULT_NUMBER_OF_BINS}getVariantForUserBin(){const e=this.userBin(),t=this.abTests.flatMap(r=>r.variants);let i=0;for(const r of t)if(i+=l.DEFAULT_NUMBER_OF_BINS*(r.traffic_percentage||0)/100,e<i)return r;return null}getEvenSelections(e){const t=this.getVariantForUserBin();if(!t)return[];const i=e.find(r=>r.optimization.variants.some(n=>n.id===t.id));return i?[new b({optimization:i.optimization,matchingVariant:i.matchingVariant,selectedVariant:t,isFirstAssignment:!i.cachedVariant,languageRootUrl:this.languageRootUrl})]:[]}getAbTestMatches(e){const t=[];return this.abTests.forEach(i=>{const r=this.getMatchingVariant(i,e);if(r){const n=this.getCachedVariant(i);(r.config.original||n)&&t.push({optimization:i,matchingVariant:r,cachedVariant:n})}}),t}getAbTestSelections(e){const t=this.getAbTestMatches(e);if(t.length===0)return[];const i=t.find(r=>!!r.cachedVariant);if(!i&&this.hasAnyCachedVariants())return[];if(i)return[new b({optimization:i.optimization,matchingVariant:i.matchingVariant,selectedVariant:i.cachedVariant,isFirstAssignment:!1,languageRootUrl:this.languageRootUrl})];switch(this.distributionMethod){case"greedy":return this.getGreedySelections(t);case"even":return this.getEvenSelections(t);default:throw new Error(`Unknown distribution method: ${this.distributionMethod}`)}}isBot(){const e=navigator.userAgent,t=k(e);return console.debug("Bot testing with user agent:",e),t}handleThemeReview(){const t=new URLSearchParams(location.search).get("shgpvid"),i=sessionStorage.getItem("_shg_preview_variant_id");if(i&&(!t||i==t)){console.debug(`shogun: theme review in progress, viewing variant: ${i}`);const r=document.getElementById("shogun-price-test-preview");if(!r){console.debug("shogun: sidebar not found!!!");return}const n=r.content.cloneNode(!0);document.addEventListener("DOMContentLoaded",()=>{document.body.style.paddingLeft="32rem",document.body.prepend(n)});return}else if(t&&(!i||i!=t)){console.debug(`shogun: theme review in progress, setting variant: ${t}`),sessionStorage.setItem("_shg_preview_variant_id",t);const r=JSON.stringify({attributes:{shogun_variant_id:t}}),n=new XMLHttpRequest;n.open("POST","/cart/update.js",!0),n.setRequestHeader("Content-Type","application/json"),n.onreadystatechange=()=>{n.readyState==4&&n.status==200&&(console.debug("shogun: reloading to reflect cart pricing"),location=location)},n.send(r)}}run(){var r,n,a,o;let e=null,t=this.distributionMethod,i=[];try{if(this.isBot()){console.debug("Bot traffic detected, optimizer disabled");return}this.handleThemeReview();const d=this.getPrioritizedNonDefaultPersonalizationSelection(),g=this.getAbTestSelections(d);g.forEach(u=>{this.setCachedVariant(u.optimization,u.selectedVariant)});const h=[];d&&h.push(d),h.push(...g),h.push(...this.getDefaultPersonalizationSelectionsForImpressionTracking(d)),localStorage.getItem("_shg_is_merchant")||this.themeTestHandler.run(),e=h.find(u=>u.matchingVariant.id===u.selectedVariant.id)||null,e&&!e.isFirstAssignment&&(t="cache"),i=h.map(u=>({optimization_id:u.optimization.id,selected_variant_id:u.selectedVariant.id,matching_variant_id:u.matchingVariant.id}));const _={shop_id:this.shopId,optimization_id:(r=e==null?void 0:e.optimization)==null?void 0:r.id,variant_id:(n=e==null?void 0:e.selectedVariant)==null?void 0:n.id,details:{optimization_ids:this.optimizations.map(u=>u.id),distribution_method:t,selection_details:i}};if(h.length===0){this.abTests.length>0&&(this.trackingService.trackPage(),this.trackingService.trackDispatch("skipped",_));return}this.dispatcher.dispatch(h,this.currentPricingVariantId),this.trackingService.trackDispatch("dispatched",_)}catch(d){const g={shop_id:this.shopId,optimization_id:(a=e==null?void 0:e.optimization)==null?void 0:a.id,variant_id:(o=e==null?void 0:e.selectedVariant)==null?void 0:o.id,details:{optimization_ids:this.optimizations.map(h=>h.id),distribution_method:t,selection_details:i,error:d.message}};this.trackingService.trackDispatch("errored",g)}}};c(l,"DEFAULT_NUMBER_OF_BINS",1e4),c(l,"DEFAULT_DISTRIBUTION_METHOD","greedy"),c(l,"OPTIMIZATIONS_CACHE_KEY","_shg_ab_optimizations_cache"),c(l,"DISPATCHER_SESSION_COOKIE","_shg_dispatcher_session");let E=l;window.ShogunOptimizer=E})();

</script>

{%- assign shogun_variant_id = cart.attributes.shogun_variant_id -%}
{%- if shogun_variant_id != nil -%}
  {%- assign price_tests = shop.metafields.app--214825828353.price-tests -%}
  {%- assign optimization_config = nil -%}
  {% for optimization in shop.metafields.app--214825828353.price-tests.value %}
    {% for variants in optimization.variants %}
      {% if variants.id == shogun_variant_id %}
        {% assign optimization_config = optimization %}
      {% endif %}
    {% endfor %}
  {% endfor %}

  {%- assign default_price_change = 0 -%}
  {%- assign image_size = 40 -%}
  {%- assign arrow_symbol = '<svg xmlns="http://www.w3.org/2000/svg" width="10" height="12" viewBox="0 0 10 12" fill="none"><path d="M4.92296 10.5227C4.55973 10.8482 4.55973 11.3758 4.92296 11.7012C5.28619 12.0267 5.8751 12.0267 6.23833 11.7012L9.33869 8.92346C9.70192 8.59802 9.70192 8.07038 9.33869 7.74494L6.23833 4.96717C5.8751 4.64173 5.28619 4.64173 4.92296 4.96717C4.55973 5.2926 4.55973 5.82024 4.92296 6.14568L6.43552 7.50087L4.65054 7.50087C3.10948 7.50087 1.86021 6.38158 1.86021 5.00087L1.86021 0.834201C1.86021 0.373964 1.44379 0.000867717 0.930106 0.000867762C0.416423 0.000867807 -4.79388e-07 0.373964 -4.39152e-07 0.834201L-6.07103e-07 5.00087C-4.05927e-07 7.30205 2.08212 9.16753 4.65054 9.16753L6.43552 9.16753L4.92296 10.5227Z" fill="#4A4A4A"/></svg>' -%}
  {%- assign caret_symbol = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.23966 11.7996C6.5432 12.0814 7.01775 12.0639 7.2996 11.7603L10 8.85221L12.7004 11.7603C12.9823 12.0639 13.4568 12.0814 13.7603 11.7996C14.0639 11.5177 14.0815 11.0432 13.7996 10.7397L10.5496 7.23966C10.4077 7.08683 10.2086 7 10 7C9.79145 7 9.59232 7.08683 9.45041 7.23966L6.20041 10.7397C5.91856 11.0432 5.93613 11.5177 6.23966 11.7996Z" fill="#4A4A4A"/></svg>' -%}

  {% if optimization_config and optimization_config.status == "draft" %}
    <template id="shogun-price-test-preview">
      <style>
        .shogun-price-test-preview-sidebar {
          position: fixed;
          width: 32rem;
          top: 0;
          background-color: white;
          height: 100%;
          left: 0;
          line-height: 2rem;
          overflow-y: auto;
        }

        .shogun-price-test-preview-sidebar-header {
          border-bottom: 1px solid #e5e7eb;
          font-size: 1rem;
          display: flex;
          flex-direction: row;
          align-items: center;
          justify-content: space-between;
          padding: 1rem;
        }

        .shogun-price-test-preview-sidebar-title {
          font-weight: 650;
          color: #251A00;
        }

        .shogun-price-test-preview-sidebar-subtitle {
          font-weight: 550;
          color: #303030;
        }

        .shogun-price-test-preview-sidebar-content {
          padding: 1rem;
          font-size: 1rem;
          color: #303030;
        }

        .shogun-price-test-preview-sidebar-contact-support-button {
          background: #303030;
          font-weight: 650;
          font-size: 1rem;
          color: #FFFFFF;
          border-radius: 12px;
          padding: 6px 12px;
          cursor: pointer;
       
          &:hover {
            background: #444444;
          }
        }

        .shogun-price-test-preview-sidebar-currency-warn {
          background-color: red;
          color: white;
          padding: 10px;
          margin: 10px 0;
          border-radius: 10px;
          text-align: center;
          font-weight: 550;
          font-size: 1.5rem;
        }

        .shogun-price-test-preview-sidebar-product-collection-container {
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: flex-start;
          margin-top: 1.5rem;
          gap: 0.5rem;
          color: #303030;
        }

        .shogun-price-test-preview-sidebar-product-collection-header {
          display: flex;
          flex-direction: row;
          align-items: center;
          justify-content: space-between;
          width: 100%;
          padding: 0.5rem 0;
          gap: 0.8rem;
        }

        .shogun-price-test-preview-sidebar-product-collection-header-child {
          display: flex;
          flex-direction: row;
          align-items: center;
          gap: 0.75rem;
        }

        .shogun-price-test-preview-sidebar-image-container {
          flex: none;
          box-shadow: inset 0px 0px 0px 1px rgba(0, 0, 0, 0.08);
          border-radius: 0.5rem;

          img {
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            vertical-align: middle;
          }
        }

        .shogun-price-test-preview-sidebar-title-container {
          flex: 1;
          font-size: 1rem;
          font-weight: 550;

          span {
            vertical-align: middle;
          }
        }
        
        .shogun-price-test-preview-sidebar-product-collection-item-container {
          width: 100%;
        }

        .shogun-price-test-preview-sidebar-product-collection-caret {
          background: none;
          border: none;
          cursor: pointer;
          padding: 0;
          height: 2rem;
          font-size: 1rem;
          color: #6b7280;
          transition: transform 0.3s ease-in-out;

          &:hover {
            color: #374151;
          }

          &.collapsed {
            transform: rotate(180deg);
          }
        }

        .shogun-price-test-preview-sidebar-collection-badge {
          padding: 0.20rem 0.8rem;
          border-radius: 1rem;
          font-size: 1rem;
          font-weight: 550;
          color: #00527C;
          background-color: #E0F0FF;
          line-height: 1.5rem;
        }

        .shogun-price-test-preview-sidebar-count-badge {
          color: #5700D1;
          background: #F8F7FF;
          border: 1px solid #5700D1;
          border-radius: 0.5rem;
          padding: 0.20rem 0.8rem;
          font-size: 1rem;
          line-height: 1.5rem;
          font-weight: 550;
        }

        .shogun-price-test-preview-sidebar-product-collection-children {
          margin-left: 1.5rem;
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
          overflow: hidden;
          transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out;
          max-height: 1000px;
          opacity: 1;

          &.collapsed {
            max-height: 0;
            opacity: 0;
          }
        }

        .shogun-price-test-preview-sidebar-product-collection-child-item {
          display: flex;
          flex-direction: row;
          align-items: center;
          gap: 0.8rem;
          padding: 0.25rem 0;
          justify-content: space-between;
        }

        .shogun-price-test-preview-sidebar-product-collection-child-arrow {
          color: #6b7280;
          font-size: 0.875rem;
          width: 1rem;
          text-align: center;
        }

        .shogun-price-test-preview-sidebar-product-collection-child-pricing {
          font-size: 0.875rem;
          font-weight: 500;
          color: #374151;
          display: flex;
          gap: 0.5rem;
        }

        .shogun-price-test-preview-sidebar-product-collection-child-pricing > div {
          display: inline-block;
        }

        .shogun-price-test-preview-sidebar-product-collection-child-main-content {
          display: flex;
          justify-content: flex-start;
          gap: 0.5rem;
          align-items: center;
        }
      </style>  
      <div class="shogun-price-test-preview-sidebar">
        <div class="shogun-price-test-preview-sidebar-header">
          <div class="shogun-price-test-preview-sidebar-title">
            Something not working properly?
          </div>
          <button class="shogun-price-test-preview-sidebar-contact-support-button" onclick="contactSupport()">Contact us</button>
        </div>

        <div class="shogun-price-test-preview-sidebar-content">
          <div class="shogun-price-test-preview-sidebar-subtitle">
            Go check your product pages, collection pages,
            and anywhere else the price might appear on your store.
          </div>
          <div class="shogun-price-test-preview-sidebar-product-collection-container">
            {% for collection_config in optimization_config.collections -%}
              {%- assign collection = collections[collection_config.handle] -%}
              {% if collection != nil %}
                <div class="shogun-price-test-preview-sidebar-product-collection-item-container">
                  <div class="shogun-price-test-preview-sidebar-product-collection-header">
                    <div class="shogun-price-test-preview-sidebar-product-collection-header-child">
                      <div class="shogun-price-test-preview-sidebar-image-container">
                        <img src="{{ collection.featured_image | image_url: width: image_size }}" width="{{ image_size }}" height="{{ image_size }}"/>
                      </div>
                      <div class="shogun-price-test-preview-sidebar-title-container">
                        <span>{{ collection.title }}</span>
                      </div>
                      <button class="shogun-price-test-preview-sidebar-product-collection-caret" onclick="toggleCollection('collection-{{ forloop.index }}')">
                        {{ caret_symbol }}
                      </button>
                      <div class="shogun-price-test-preview-sidebar-collection-badge">
                        Collection
                      </div>
                    </div>
                    <div class="shogun-price-test-preview-sidebar-product-collection-header-child">
                      <div class="shogun-price-test-preview-sidebar-count-badge">
                        {{ collection_config.productIds.size }}
                      </div>
                    </div>
                  </div>
                  <div class="shogun-price-test-preview-sidebar-product-collection-children" id="collection-{{ forloop.index }}">
                    {% for product in collection.products %}
                      {% for product_config in optimization_config.products %}
                        {% if product.title != blank and product.id == product_config.id and product.variants.size > 0 %}
                          <div class="shogun-price-test-preview-sidebar-product-collection-child-item shogun-price-test-preview-sidebar-product-collection-child-item-flex">
                            <div class="shogun-price-test-preview-sidebar-product-collection-child-main-content">
                              <div class="shogun-price-test-preview-sidebar-product-collection-child-arrow">
                                {{ arrow_symbol }}
                              </div>
                              <div class="shogun-price-test-preview-sidebar-image-container">
                                <img src="{{ product.featured_image | image_url: width: image_size }}" width="{{ image_size }}" height="{{ image_size }}"/>
                              </div>
                              <div class="shogun-price-test-preview-sidebar-title-container">
                                <span>{{ product.title }}</span>
                              </div>
                              {% if product.variants.size > 1 %}
                              <button class="shogun-price-test-preview-sidebar-product-collection-caret" onclick="toggleProduct('collection-{{ forloop.parentloop.index }}-product-{{ forloop.index }}')">
                                {{ caret_symbol }}
                              </button>
                              {% endif %}
                            </div>
                            {% if product.variants.size > 1 %}
                              <div class="shogun-price-test-preview-sidebar-count-badge">
                                {{ product_config.variant_pricing.size }}
                              </div>
                            {% endif %}
                            {% if product.variants.size == 1 %}
                              <div class="shogun-price-test-preview-sidebar-product-collection-child-pricing">
                                {%- assign original_price = product_config.variant_pricing.first.original_price -%}
                                {%- assign new_price = product_config.variant_pricing.first.test_price -%}
                                {%- assign price_change = product_config.variant_pricing.first.price_change -%}

                                {%- comment -%} Convert prices to presentment currency {%- endcomment -%}
                                {%- assign variant = product.variants.first -%}
                                {%- assign presentment_price = variant.price -%}
                                {%- assign shop_currency_price_cents = original_price | times: 100 -%}

                                {%- if presentment_price != shop_currency_price_cents -%}
                                  {%- assign currency_ratio = presentment_price | divided_by: shop_currency_price_cents -%}
                                  {%- assign converted_original = original_price | times: currency_ratio | round: 2 | times: 100 -%}
                                  {%- assign converted_new = new_price | times: currency_ratio | round: 2 | times: 100 -%}
                                {%- else -%}
                                  {%- assign converted_original = original_price | times: 100 -%}
                                  {%- assign converted_new = new_price | times: 100 -%}
                                {%- endif -%}

                                <div>{{ converted_original | money }}</div>
                                <div>{{ price_change }}%</div>
                                <div>{{ converted_new | money }}</div>
                              </div>
                            {% endif %}
                          </div>
                          {% if product.variants.size > 1 %}
                            <div class="shogun-price-test-preview-sidebar-product-collection-children" id="collection-{{ forloop.parentloop.index }}-product-{{ forloop.index }}">
                              {% for variant in product.variants %}
                                {% for variant_pricing in product_config.variant_pricing %}
                                  {% if variant_pricing.id == variant.id %}
                                    <div class="shogun-price-test-preview-sidebar-product-collection-child-item">
                                      <div class="shogun-price-test-preview-sidebar-product-collection-child-arrow">
                                        {{ arrow_symbol }}
                                      </div>
                                      <div class="shogun-price-test-preview-sidebar-image-container">
                                        <img src="{{ variant.featured_image | default: product.featured_image | image_url: width: image_size }}" width="{{ image_size }}" height="{{ image_size }}"/>
                                      </div>
                                      <div class="shogun-price-test-preview-sidebar-title-container">
                                        <span>{{ variant.title | default: product.title }}</span>
                                      </div>
                                      <div class="shogun-price-test-preview-sidebar-product-collection-child-pricing">
                                        {%- assign original_price = variant_pricing.original_price -%}
                                        {%- assign new_price = variant_pricing.test_price -%}
                                        {%- assign price_change = variant_pricing.price_change -%}

                                        {%- comment -%} Convert prices to presentment currency {%- endcomment -%}
                                        {%- assign presentment_price = variant.price -%}
                                        {%- assign shop_currency_price_cents = original_price | times: 100 -%}

                                        {%- if presentment_price != shop_currency_price_cents -%}
                                          {%- assign currency_ratio = presentment_price | divided_by: shop_currency_price_cents -%}
                                          {%- assign converted_original = original_price | times: currency_ratio | round: 2 | times: 100 -%}
                                          {%- assign converted_new = new_price | times: currency_ratio | round: 2 | times: 100 -%}
                                        {%- else -%}
                                          {%- assign converted_original = original_price | times: 100 -%}
                                          {%- assign converted_new = new_price | times: 100 -%}
                                        {%- endif -%}

                                        <div>{{ converted_original | money }}</div>
                                        <div>{{ price_change }}%</div>
                                        <div>{{ converted_new | money }}</div>
                                      </div>
                                    </div>
                                  {% endif %}
                                {% endfor %}
                              {% endfor %}
                            </div>
                          {% endif %}
                        {% endif %}
                      {%  endfor %}
                    {% endfor %}
                  </div>
                </div>
              {% endif %}
            {% endfor -%}
            {%- assign products_in_collections = '' -%}
            {% for collection_config in optimization_config.collections -%}
              {%- assign collection = collections[collection_config.handle] -%}
              {% if collection != nil %}
                {% for product in collection.products %}
                  {%- assign products_in_collections = products_in_collections | append: product.handle | append: ',' -%}
                {% endfor %}
              {% endif %}
            {% endfor -%}
            {% for product_config in optimization_config.products -%}
              {%- assign product = all_products[product_config.handle] -%}
              {%- assign product_in_collection = false -%}
              {%- if products_in_collections contains product_config.handle -%}
                {%- assign product_in_collection = true -%}
              {%- endif -%}
              {% if product != nil and product_in_collection == false and product.title != blank and product.variants.size > 0 %}
                <div class="shogun-price-test-preview-sidebar-product-collection-item-container">
                  <div class="shogun-price-test-preview-sidebar-product-collection-header">
                    <div class="shogun-price-test-preview-sidebar-product-collection-header-child">
                      <div class="shogun-price-test-preview-sidebar-image-container">
                        <img src="{{ product.featured_image | image_url: width: image_size }}" width="{{ image_size }}" height="{{ image_size }}"/>
                      </div>
                      <div class="shogun-price-test-preview-sidebar-title-container">
                        <span>{{ product.title }}</span>
                      </div>
                      {% if product.variants.size > 1 %}
                        <button class="shogun-price-test-preview-sidebar-product-collection-caret" onclick="toggleProduct('product-{{ forloop.index }}')">
                          {{ caret_symbol }}
                        </button>
                      {% endif %}
                    </div>
                    <div class="shogun-price-test-preview-sidebar-product-collection-header-child">
                      {% if product.variants.size > 1 %}
                        <div class="shogun-price-test-preview-sidebar-count-badge">
                          {{ product_config.variant_pricing.size }}
                        </div>
                      {% endif %}
                      {% if product.variants.size == 1 %}
                        <div class="shogun-price-test-preview-sidebar-product-collection-child-pricing">
                          {%- assign original_price = product_config.variant_pricing.first.original_price -%}
                          {%- assign new_price = product_config.variant_pricing.first.test_price -%}
                          {%- assign price_change = product_config.variant_pricing.first.price_change -%}

                          {%- comment -%} Convert prices to presentment currency {%- endcomment -%}
                          {%- assign variant = product.variants.first -%}
                          {%- assign presentment_price = variant.price -%}
                          {%- assign shop_currency_price_cents = original_price | times: 100 -%}

                          {%- if presentment_price != shop_currency_price_cents -%}
                            {%- assign currency_ratio = presentment_price | divided_by: shop_currency_price_cents -%}
                            {%- assign converted_original = original_price | times: currency_ratio | round: 2 | times: 100 -%}
                            {%- assign converted_new = new_price | times: currency_ratio | round: 2 | times: 100 -%}
                          {%- else -%}
                            {%- assign converted_original = original_price | times: 100 -%}
                            {%- assign converted_new = new_price | times: 100 -%}
                          {%- endif -%}

                          <div>{{ converted_original | money }}</div>
                          <div>{{ price_change }}%</div>
                          <div>{{ converted_new | money }}</div>
                        </div>
                      {% endif %}
                    </div>
                  </div>
                  {% if product.variants.size > 1 %}
                    <div class="shogun-price-test-preview-sidebar-product-collection-children" id="product-{{ forloop.index }}">
                      {% for variant in product.variants %}
                        {% for variant_pricing in product_config.variant_pricing %}
                          {% if variant_pricing.id == variant.id %}
                            <div class="shogun-price-test-preview-sidebar-product-collection-child-item">
                              <div class="shogun-price-test-preview-sidebar-product-collection-child-arrow">
                                {{ arrow_symbol }}
                              </div>
                              <div class="shogun-price-test-preview-sidebar-image-container">
                                <img src="{{ variant.featured_image | default: product.featured_image | image_url: width: image_size }}" width="{{ image_size }}" height="{{ image_size }}"/>
                              </div>
                              <div class="shogun-price-test-preview-sidebar-title-container">
                                <span>{{ variant.title | default: product.title }}</span>
                              </div>
                              <div class="shogun-price-test-preview-sidebar-product-collection-child-pricing">
                                {%- assign original_price = variant_pricing.original_price -%}
                                {%- assign new_price = variant_pricing.test_price -%}
                                {%- assign price_change = variant_pricing.price_change -%}

                                {%- comment -%} Convert prices to presentment currency {%- endcomment -%}
                                {%- assign presentment_price = variant.price -%}
                                {%- assign shop_currency_price_cents = original_price | times: 100 -%}

                                {%- if presentment_price != shop_currency_price_cents -%}
                                  {%- assign currency_ratio = presentment_price | divided_by: shop_currency_price_cents -%}
                                  {%- assign converted_original = original_price | times: currency_ratio | round: 2 | times: 100 -%}
                                  {%- assign converted_new = new_price | times: currency_ratio | round: 2 | times: 100 -%}
                                {%- else -%}
                                  {%- assign converted_original = original_price | times: 100 -%}
                                  {%- assign converted_new = new_price | times: 100 -%}
                                {%- endif -%}

                                <div>{{ converted_original | money }}</div>
                                <div>{{ price_change }}%</div>
                                <div>{{ converted_new | money }}</div>
                              </div>
                            </div>
                          {% endif %}
                        {% endfor %}
                      {% endfor %}
                    </div>
                  {% endif %}
                </div> 
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>
    </template>
    <script>
      const COLLAPSED_STATE_KEY = 'shogun_price_test_sidebar_collapsed_state';
      
      function saveCollapsedState(elementId, isCollapsed) {
        try {
          const state = JSON.parse(localStorage.getItem(COLLAPSED_STATE_KEY) || '{}');
          state[elementId] = isCollapsed;
          localStorage.setItem(COLLAPSED_STATE_KEY, JSON.stringify(state));
        } catch (e) {
          console.warn('Failed to save collapsed state:', e);
        }
      }
      
      function restoreCollapsedState() {
        try {
          const state = JSON.parse(localStorage.getItem(COLLAPSED_STATE_KEY) || '{}');
          
          Object.keys(state).forEach(elementId => {
            const element = document.getElementById(elementId);
            if (element) {
              const caret = element.previousElementSibling?.querySelector('.shogun-price-test-preview-sidebar-product-collection-caret');
              
              if (state[elementId]) {
                element.classList.add('collapsed');
                if (caret) {
                  caret.classList.add('collapsed');
                }
              } else {
                element.classList.remove('collapsed');
                if (caret) {
                  caret.classList.remove('collapsed');
                }
              }
            }
          });
        } catch (e) {
          console.warn('Failed to restore collapsed state:', e);
        }
      }
      
      function toggleElement(elementId) {
        const children = document.getElementById(elementId);
        const caret = children.previousElementSibling.querySelector('.shogun-price-test-preview-sidebar-product-collection-caret');
        
        if (children.classList.contains('collapsed')) {
          // Expand: remove collapsed class first, then rotate caret
          children.classList.remove('collapsed');
          caret.classList.remove('collapsed');
          saveCollapsedState(elementId, false);
        } else {
          // Collapse: add collapsed class, then rotate caret
          children.classList.add('collapsed');
          caret.classList.add('collapsed');
          saveCollapsedState(elementId, true);
        }
      }
      
      function toggleCollection(collectionId) {
        toggleElement(collectionId);
      }

      function toggleProduct(productId) {
        toggleElement(productId);
      }

      function contactSupport() {
        const subject = encodeURIComponent('A/B Testing Question');
        const body = encodeURIComponent('Hi Shogun Team,\n\n');
        const mailtoLink = `mailto:support-ab@getshogun.com?subject=${subject}&body=${body}`;
        window.open(mailtoLink, '_blank');
      }
      
      // Restore collapsed state when the page loads
      document.addEventListener('DOMContentLoaded', function() {
        // Small delay to ensure all elements are rendered
        setTimeout(restoreCollapsedState, 100);
      });
    </script>
  {% endif %}
{%- endif -%}

<script type="text/javascript">
  ;(function() {
    if (typeof ShogunOptimizer === 'undefined') {
      console.error("ShogunOptimizer is not defined. Please ensure the optimizer script is properly loaded.");
      return;
    }

    const designMode = {{ request.design_mode | default: false }};
    if (designMode) {
      console.debug("Design mode is enabled, skipping optimizer initialization");
      return;
    }

    // If the referrer url is the Shopify admin url, then set a local storage shg_is_merchant flag to true
    // This is used to remove the preview bar from the page for shoppers
    const referrer = document.referrer
    if (!localStorage.getItem('_shg_is_merchant') && ((referrer.includes('admin.shopify.com') || referrer.includes('shogun')))) {
      console.debug('Setting shg_is_merchant to true')
      localStorage.setItem('_shg_is_merchant', 'true')
    }

    const urlParams = new URLSearchParams(window.location.search);
    const optimizationDisabled = urlParams.get('shg') === "false" || window.location.hostname.includes('shopifypreview');

    if (optimizationDisabled) {
      console.debug("Optimization is disabled, skipping optimizer initialization");
      return;
    }

    const shopMetafieldConfig = {{ shop.metafields.shgabc.optimizations }} || {};
    const optimizationsData = shopMetafieldConfig.expires_at > Date.now() ? (shopMetafieldConfig.optimizations || []) : [];

    const optimizerConfig = {
      shopId: "552f89ea-9faf-4caf-b102-54346ef41303",
      optimizations: optimizationsData,
      distributionMethod: urlParams.get('shgMethod') || shopMetafieldConfig.method,
      defaultThemeId: String(shopMetafieldConfig.default_theme_id),
      currentThemeId: "179206914416",
      pageId: "{{ content.id }}",
      pageType: "{% if template.name == 'list-collections' %}list-collections{% elsif article %}article{% elsif blog %}blog{% elsif page %}page{% elsif product %}product{% elsif collection %}collection{% elsif metaobject %}metaobject{% else %}homepage{% endif %}",
      templateName: "{{ template.name }}",
      templateSuffix: "{{ template.suffix }}",
      customerId: "{{ customer.id }}",
      isB2B: {{ customer.b2b? | default: false }},
      cacheEnabled: urlParams.get('cache') !== "false",
      sessionIdOverride: urlParams.get('shgSessionId'),
      geoLocationApi: "https://ipinfo.io/json?token=f2ae3a557d807b",
      currentPricingVariantId: {% if cart.attributes.shogun_variant_id %}"{{ cart.attributes.shogun_variant_id }}"{% else %}null{%  endif %},
      languageRootUrl: "{{ localization.language.root_url }}",
      analyticsUrl: "https://shogun-abc-production.global.ssl.fastly.net"
    };

    console.debug("Initializing ShogunOptimizer with config:", optimizerConfig);
    const optimizer = new ShogunOptimizer(optimizerConfig);
    optimizer.run();
  })();
</script>
