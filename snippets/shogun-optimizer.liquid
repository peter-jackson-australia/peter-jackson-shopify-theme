{% comment %}
Auto-generated by Shogun-AB.
This file can be re-written at any time.
{% endcomment %}


{% if article %}
  {% assign content = article %}
{% elsif blog %}
  {% assign content = blog %}
{% elsif page %}
  {% assign content = page %}
{% elsif product %}
  {% assign content = product %}
{% elsif collection %}
  {% assign content = collection %}
{% elsif metaobject %}
  {% assign content = metaobject.system %}
{% endif %}

<script type="text/javascript">
  var H=Object.defineProperty;var J=(g,u,l)=>u in g?H(g,u,{enumerable:!0,configurable:!0,writable:!0,value:l}):g[u]=l;var o=(g,u,l)=>J(g,typeof u!="symbol"?u+"":u,l);(function(){"use strict";var g=" daum[ /]| deusu/| yadirectfetcher|(?:^|[^g])news(?!sapphire)|(?<! (?:channel/|google/))google(?!(app|/google| pixel))|(?<! cu)bots?(?:\\b|_)|(?<!(?:lib))http|(?<![hg]m)score|(?<!cam)scan|@[a-z][\\w-]+\\.|\\(\\)|\\.com\\b|\\btime/|\\||^<|^[\\w \\.\\-\\(?:\\):%]+(?:/v?\\d+(?:\\.\\d+)?(?:\\.\\d{1,10})*?)?(?:,|$)|^[^ ]{50,}$|^\\d+\\b|^\\w*search\\b|^\\w+/[\\w\\(\\)]*$|^active|^ad muncher|^amaya|^avsdevicesdk/|^biglotron|^bot|^bw/|^clamav[ /]|^client/|^cobweb/|^custom|^ddg[_-]android|^discourse|^dispatch/\\d|^downcast/|^duckduckgo|^email|^facebook|^getright/|^gozilla/|^hobbit|^hotzonu|^hwcdn/|^igetter/|^jeode/|^jetty/|^jigsaw|^microsoft bits|^movabletype|^mozilla/\\d\\.\\d\\s[\\w\\.-]+$|^mozilla/\\d\\.\\d\\s\\(compatible;?(?:\\s\\w+\\/\\d+\\.\\d+)?\\)$|^navermailapp|^netsurf|^offline|^openai/|^owler|^php|^postman|^python|^rank|^read|^reed|^rest|^rss|^snapchat|^space bison|^svn|^swcd |^taringa|^thumbor/|^track|^w3c|^webbandit/|^webcopier|^wget|^whatsapp|^wordpress|^xenu link sleuth|^yahoo|^yandex|^zdm/\\d|^zoom marketplace/|^{{.*}}$|analyzer|archive|ask jeeves/teoma|audit|bit\\.ly/|bluecoat drtr|browsex|burpcollaborator|capture|catch|check\\b|checker|chrome-lighthouse|chromeframe|classifier|cloudflare|convertify|crawl|cypress/|dareboost|datanyze|dejaclick|detect|dmbrowser|download|evc-batch/|exaleadcloudview|feed|firephp|functionize|gomezagent|grab|headless|httrack|hubspot marketing grader|hydra|ibisbrowser|infrawatch|insight|inspect|iplabel|ips-agent|java(?!;)|library|linkcheck|mail\\.ru/|manager|measure|neustar wpm|node|nutch|offbyone|onetrust|optimize|pageburst|pagespeed|parser|perl|phantomjs|pingdom|powermarks|preview|proxy|ptst[ /]\\d|retriever|rexx;|rigor|rss\\b|scrape|server|sogou|sparkler/|speedcurve|spider|splash|statuscake|supercleaner|synapse|synthetic|tools|torrent|transcoder|url|validator|virtuoso|wappalyzer|webglance|webkit2png|whatcms/|xtate/",u=/bot|crawl|http|lighthouse|scan|search|spider/i,l;function z(){if(l instanceof RegExp)return l;try{l=new RegExp(g,"i")}catch{l=u}return l}function E(s){return!!s&&z().test(s)}/*! js-cookie v3.0.5 | MIT */function w(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)s[i]=t[i]}return s}var P={read:function(s){return s[0]==='"'&&(s=s.slice(1,-1)),s.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(s){return encodeURIComponent(s).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function y(s,e){function t(r,n,a){if(!(typeof document>"u")){a=w({},e,a),typeof a.expires=="number"&&(a.expires=new Date(Date.now()+a.expires*864e5)),a.expires&&(a.expires=a.expires.toUTCString()),r=encodeURIComponent(r).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var c="";for(var d in a)a[d]&&(c+="; "+d,a[d]!==!0&&(c+="="+a[d].split(";")[0]));return document.cookie=r+"="+s.write(n,r)+c}}function i(r){if(!(typeof document>"u"||arguments.length&&!r)){for(var n=document.cookie?document.cookie.split("; "):[],a={},c=0;c<n.length;c++){var d=n[c].split("="),T=d.slice(1).join("=");try{var v=decodeURIComponent(d[0]);if(a[v]=s.read(T,v),r===v)break}catch{}}return r?a[r]:a}}return Object.create({set:t,get:i,remove:function(r,n){t(r,"",w({},n,{expires:-1}))},withAttributes:function(r){return y(this.converter,w({},this.attributes,r))},withConverter:function(r){return y(w({},this.converter,r),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(s)}})}var D=y(P,{path:"/"});const A=s=>{const e=window.innerWidth<768||window.outerWidth<768?"mobile":"desktop";return s===e},O=(s,e)=>{const t=!!e,i=String(s)==="true";return t===i},b="shg_geo_data";function C(s,e){const t=s-e;return Math.floor(t/(1e3*60*60*24))}function k(){if(new URLSearchParams(window.location.search).get("shg_geo_cache")==="false")return null;let e=null;try{const t=localStorage.getItem(b);if(t){const i=JSON.parse(t),r=Date.now();i.timestamp&&C(r,i.timestamp)<=7?e=i:localStorage.removeItem(b)}}catch(t){return console.error("Error reading geo data from cache:",t),localStorage.removeItem(b),null}return e}function R(s){let e=null;if(!s)return console.warn("Geo location API URL not configured."),e;try{const t=new XMLHttpRequest;t.open("GET",s,!1),t.send(null),t.status===200?(e=JSON.parse(t.responseText),e?(e.timestamp=Date.now(),localStorage.setItem(b,JSON.stringify(e))):(console.error("Geo API response parsed to null or undefined."),e=null)):console.error(`Geo API request failed with status: ${t.status}`)}catch(t){console.error("Error fetching geo data from API:",t)}return e}function M(s){let e=null;try{const t=k();t?(e=t,console.debug("Loaded geo data from cache:",e)):(e=R(s),console.debug("Fetched geo data from API:",e))}catch(t){console.error("Error initializing geo data:",t),e=null}return e}const L=(s,e)=>{const{type:t,countryCode:i,toponymName:r,parentName:n}=s||{},{country:a,region:c,city:d}=e||{};if(!t||!i||!e)return!1;switch(t){case"country":return a===i;case"region":return c===r&&a===i;case"city":return d===r&&c===n&&a===i;default:return console.debug("Unknown location type:",t),!1}},B=s=>typeof s!="string"?!1:document.referrer.toLowerCase().includes(s.toLowerCase()),F=s=>typeof s!="string"?!1:window.location.href.toLowerCase().includes(s.toLowerCase()),N=(s,e,t)=>{if(!e)return!1;const{expectedTimeInMillseconds:i,withinOrAfter:r}=s||{};if(typeof i!="number"||!r)return!1;const n=e.first_visit_timestamp;return r==="within"?n+i>t:n+i<t},U=(s,e,t)=>e?t-e.first_visit_timestamp<18e5===s:s===!0;function G(s,e){return s===e}const p=class p{constructor(e){o(this,"visitorDetails",null);o(this,"currentTime");o(this,"geoLocationApi");o(this,"customerId");o(this,"isB2B");o(this,"internalGeoData");o(this,"isGeoDataInitialized",!1);o(this,"checkers",{device:e=>A(e),logged_in:(e,t)=>O(e,this.customerId),new_visitor:(e,t)=>U(e,t.visitorDetails,t.currentTime),returning_visitor:(e,t)=>N(e,t.visitorDetails,t.currentTime),url_contains:e=>F(e),referrer_contains:e=>B(e),location:(e,t)=>L(e,t.geoData),b2b:e=>G(e,this.isB2B)});this.geoLocationApi=e.geoLocationApi,this.customerId=e.customerId,this.isB2B=e.isB2B,this.currentTime=Date.now(),this.initializeVisitorDetails()}initializeVisitorDetails(){var e;try{const t=localStorage.getItem(p.VISITOR_DETAILS_KEY);t&&(this.visitorDetails=JSON.parse(t),typeof((e=this.visitorDetails)==null?void 0:e.first_visit_timestamp)!="number"&&(console.warn("Invalid visitor details found in storage, resetting."),this.visitorDetails=null)),this.visitorDetails===null?(console.debug("Initializing new visitor details."),this.visitorDetails={first_visit_timestamp:this.currentTime},localStorage.setItem(p.VISITOR_DETAILS_KEY,JSON.stringify(this.visitorDetails))):console.debug("Loaded visitor details from storage:",this.visitorDetails)}catch(t){console.error("Error initializing visitor details:",t),localStorage.removeItem(p.VISITOR_DETAILS_KEY),this.visitorDetails={first_visit_timestamp:this.currentTime},localStorage.setItem(p.VISITOR_DETAILS_KEY,JSON.stringify(this.visitorDetails))}}check(e){const t=this.checkers[e.audience_type];if(!t)return console.warn(`Unknown audience type: ${e.audience_type}`),!1;e.audience_type==="location"&&!this.isGeoDataInitialized&&(console.debug("Location check required, initializing geoData..."),this.internalGeoData=M(this.geoLocationApi),this.isGeoDataInitialized=!0,console.debug("GeoData initialization result:",this.internalGeoData));const i={geoData:this.internalGeoData===void 0?null:this.internalGeoData,visitorDetails:this.visitorDetails,currentTime:this.currentTime};try{const r=!!t(e.value,i);return console.debug("Audience check result:",{audience:e,internalContext:i,matched:r}),e.condition==="is_not"?!r:r}catch(r){return console.error("Error during audience check:",{audience:e,internalContext:i,error:r}),!1}}};o(p,"VISITOR_DETAILS_KEY","_shg_ab_visitor_details");let I=p;class x{constructor(e){this.trackingService=e}extractViewParamFromFullTemplateKey(e){const t=e.split("/").pop().split(".");return t.slice(1,t.length-1).join(".")}async handleRedirect(e){const t=new URL(window.location.href),i=new URL(window.location.href);if(e.optimization.scope=="price")i.searchParams.set("preview_theme_id",e.optimization.config.theme_id);else if(e.optimization.scope==="theme")i.searchParams.set("preview_theme_id",e.selectedVariant.config.theme_id);else if(e.optimization.scope==="url_redirect")i.pathname=e.selectedVariant.config.path;else{const r=this.extractViewParamFromFullTemplateKey(e.selectedVariant.config.full_template_key);i.searchParams.set("view",r)}t.toString()===i.toString()?this.hideViewParam():this.redirectWithoutCache(i)}hideViewParam(){const e=new URL(window.location.href);e.searchParams.delete("view"),window.history.replaceState({},"",e.toString())}dispatch(e,t){if(e[0].optimization.scope=="price"){const i=e[0];if(t)console.debug("shogun: price variant already assigned, returning");else{const r=e[0].selectedVariant.id;console.debug("shogun: assigning price variant");const n=JSON.stringify({attributes:{shogun_variant_id:r}}),a=new XMLHttpRequest;a.open("POST","/cart/update.js",!0),a.setRequestHeader("Content-Type","application/json"),a.onreadystatechange=()=>{if(a.readyState==4&&a.status==200)return console.debug("shogun: reloading to reflect cart pricing"),this.handleRedirect(i)},a.send(n)}}else{const i=e.find(n=>n.matchingVariant.id!==n.selectedVariant.id);if(console.debug("redirectingSelection",i),i&&(i.optimization.scope!=="url_redirect"||i.isFirstAssignment===!0||i.optimization.config.permanent_redirect===!0))return this.handleRedirect(i);const r=new Set(e.map(n=>n.optimization.scope));(r.has("template")||r.has("page"))&&this.hideViewParam()}e.filter(i=>i.current()).forEach(i=>{this.trackingService.trackVariantImpression(i.selectedVariant,i.optimization.type)})}redirectWithoutCache(e){typeof e=="string"&&(e=new URL(e)),e.searchParams.delete("cache"),console.debug("shogun: redirecting to ",e),window.location.replace(e)}}class m{constructor(e){o(this,"optimization");o(this,"matchingVariant");o(this,"selectedVariant");o(this,"isFirstAssignment");this.optimization=e.optimization,this.matchingVariant=e.matchingVariant,this.selectedVariant=e.selectedVariant,this.isFirstAssignment=e.isFirstAssignment}current(){return this.matchingVariant.id===this.selectedVariant.id}}const f=class f{constructor(){o(this,"ran",!1)}removePreviewBarIframe(){console.debug("Setting up preview bar iframe removal");const e=()=>{f.PREVIEW_BAR_IFRAME_IDS.forEach(t=>{const i=document.getElementById(t);i&&(console.debug(`Removing preview bar iframe with id: ${t}`),i.remove())})};e(),document.addEventListener("DOMContentLoaded",()=>{console.debug("DOM loaded, setting up mutation observer for preview bar");const t=new MutationObserver(i=>{i.forEach(r=>{r.addedNodes.forEach(n=>{if(n.nodeType===Node.ELEMENT_NODE){const a=n;f.PREVIEW_BAR_IFRAME_IDS.includes(a.id)&&(console.debug(`Detected and removing preview bar iframe with id: ${a.id} via observer`),a.remove())}})})});if(document.body)t.observe(document.body,{childList:!0,subtree:!0});else{const i=new MutationObserver(()=>{document.body&&(t.observe(document.body,{childList:!0,subtree:!0}),e(),i.disconnect())});i.observe(document.documentElement,{childList:!0})}e()})}run(){this.ran||(this.removePreviewBarIframe(),this.ran=!0)}};o(f,"PREVIEW_BAR_IFRAME_IDS",["preview-bar-iframe","PBarNextFrameWrapper"]);let _=f;class j{constructor(e,t){this.pageType=e,this.pageId=t}shogunLoaded(e){const t=()=>{var i,r;try{(r=(i=window.Shopify)==null?void 0:i.analytics)!=null&&r.publish?(console.debug("Firing shogun:load event",e),window.Shopify.analytics.publish("shogun:load",e)):console.warn("Shopify analytics not available to publish shogun:load event.")}catch(n){console.error("Error publishing shogun:load event:",n)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t()}trackVariantImpression(e,t){const i={page_type:this.pageType,page_id:this.pageId,app_type:t=="ab_test"?"ab_testing":"personalization"};i.optimization_id=e.optimization_id,i.variant_id=e.id,console.debug(`Tracking variant impression: optimization=${e.optimization_id}, variant=${e.id}`),this.shogunLoaded(i)}}const h=class h{constructor(e){o(this,"cacheEnabled");o(this,"optimizations");o(this,"currentThemeId");o(this,"pageId");o(this,"pageType");o(this,"currentPartialTemplateKey");o(this,"distributionMethod");o(this,"sessionId");o(this,"cachedOptimizations");o(this,"audienceChecker");o(this,"personalizations");o(this,"abTests");o(this,"dispatcher");o(this,"currentPath");o(this,"themeTestHandler");o(this,"currentPricingVariantId");o(this,"inAudience",e=>this.audienceChecker.check(e));this.currentThemeId=e.currentThemeId,this.currentPricingVariantId=e.currentPricingVariantId;const t=e.optimizations||[];e.defaultThemeId!==this.currentThemeId?this.optimizations=t.filter(c=>c.scope==="price"||c.variants.some(d=>d.config.theme_id===this.currentThemeId)):this.optimizations=t,this.personalizations=this.optimizations.filter(c=>c.type==="personalization"),this.abTests=this.optimizations.filter(c=>c.type==="ab_test"),this.distributionMethod=e.distributionMethod||h.DEFAULT_DISTRIBUTION_METHOD,this.pageId=e.pageId,this.pageType=e.pageType,this.cacheEnabled=e.cacheEnabled;const i=this.pageType==="metaobject"?"templates/metaobject/":"templates/",r=[e.templateName,e.templateSuffix].filter(Boolean).join(".");this.currentPartialTemplateKey=i+r,this.currentPath=window.location.pathname,this.sessionId=e.sessionIdOverride||D.get(h.SHOPIFY_SESSION_COOKIE)||"",this.cachedOptimizations=JSON.parse(localStorage.getItem(h.OPTIMIZATIONS_CACHE_KEY)||"{}"),this.audienceChecker=new I(e);const n=new j(this.pageType,this.pageId),a=new _;this.themeTestHandler=a,this.dispatcher=new x(n)}getOptimizationPriority(e){return{theme:1,template:2,page:3,url_redirect:4,price:5}[e.scope]}sortMatches(e){return[...e].sort((t,i)=>{const r=this.getOptimizationPriority(t.optimization),n=this.getOptimizationPriority(i.optimization);return r===n?0:r-n})}audienceMatchesCurrentVisitor(e){const t=e.audiences||[];return t.length===0?!0:e.audiences_condition==="any"?t.some(this.inAudience):t.every(this.inAudience)}configAudiencesMatch(e,t){const i=e.audiences||[],r=t.audiences||[];if(i.length!==r.length)return!1;const n=i.map(c=>JSON.stringify(c)),a=r.map(c=>JSON.stringify(c));return!(n.some(c=>!a.includes(c))||a.some(c=>!n.includes(c))||i.length>1&&e.audiences_condition!==t.audiences_condition)}getCachedVariant(e){if(!this.cacheEnabled)return;const t=this.cachedOptimizations[e.id];if(t)return e.variants.find(i=>i.id===t)}setCachedVariant(e,t){this.cachedOptimizations[e.id]=t.id,console.debug("setCachedVariant",e.id,t.id),localStorage.setItem(h.OPTIMIZATIONS_CACHE_KEY,JSON.stringify(this.cachedOptimizations))}extractPartialTemplateKeyFromFullTemplateKey(e){if(!e)return;const t=e.split(".");return t.length<2?e:t.slice(0,-1).join(".")}matchesAnyAttributeOfCurrentPage(e,t){const i=e.config.page_id,r=e.config.page_type,n=this.extractPartialTemplateKeyFromFullTemplateKey(t.config.full_template_key),a=t.config.theme_id,c=t.config.path,d=n===this.currentPartialTemplateKey,T=a===this.currentThemeId,v=c===this.currentPath,S=e.scope==="price"&&(!this.currentPricingVariantId||this.currentPricingVariantId===t.id),K=!r||r===this.pageType,$=!i||i===this.pageId;return T||d&&(K&&$)||v||S}getMatchingVariant(e,t=void 0){var n;const i=e.config,r=(n=t==null?void 0:t.selectedVariant)==null?void 0:n.config;for(const a of e.variants){if(!this.matchesAnyAttributeOfCurrentPage(e,a))continue;const c=e.type==="ab_test"?e.config:a.config;if(this.audienceMatchesCurrentVisitor(c)&&!(r&&!this.configAudiencesMatch(i,r)))return a}}getPersonalizationMatches(){const e=[];for(const t of this.personalizations){const i=this.getMatchingVariant(t);i&&e.push({optimization:t,matchingVariant:i})}return e}getPrioritizedNonDefaultPersonalizationSelection(){const e=this.getPersonalizationMatches();if(e.length===0)return;const t=this.sortMatches(e);for(const i of t){const n=i.optimization.variants.sort((a,c)=>a.position-c.position).find(a=>!a.config.original&&this.audienceMatchesCurrentVisitor(a.config));if(n)return new m({optimization:i.optimization,matchingVariant:i.matchingVariant,selectedVariant:n})}}getDefaultPersonalizationSelectionsForImpressionTracking(e){return this.getPersonalizationMatches().filter(r=>r.matchingVariant.config.original&&r.optimization.id!==(e==null?void 0:e.optimization.id)).map(r=>new m({optimization:r.optimization,matchingVariant:r.matchingVariant,selectedVariant:r.matchingVariant}))}getCryptoRandom(){const e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]/2**32}getRandomInt(e){const t=new Uint32Array(1);return crypto.getRandomValues(t),t[0]%e}getRandomVariantForOptimization(e){const t=this.getCryptoRandom();let i=0;for(const n of e.variants){const a=(n.config.percentage||0)/100,c=i+a;if(t>=i&&t<c)return n;i=c}const r=this.getRandomInt(e.variants.length);return e.variants[r]}hasAnyCachedVariants(){return this.cacheEnabled===!1?!1:this.abTests.some(e=>!!this.cachedOptimizations[e.id])}getGreedySelections(e){const t=e[Math.floor(Math.random()*e.length)],i=t.cachedVariant||this.getRandomVariantForOptimization(t.optimization);return[new m({optimization:t.optimization,matchingVariant:t.matchingVariant,selectedVariant:i,isFirstAssignment:!t.cachedVariant})]}userBin(){const e=this.sessionId;let t=0;if(!e)return 0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return Math.abs(t)%h.DEFAULT_NUMBER_OF_BINS}getVariantForUserBin(){const e=this.userBin(),t=this.abTests.flatMap(r=>r.variants);let i=0;for(const r of t)if(i+=h.DEFAULT_NUMBER_OF_BINS*(r.traffic_percentage||0)/100,e<i)return r;return null}getEvenSelections(e){const t=this.getVariantForUserBin();if(!t)return[];const i=e.find(r=>r.optimization.variants.some(n=>n.id===t.id));return i?[new m({optimization:i.optimization,matchingVariant:i.matchingVariant,selectedVariant:t,isFirstAssignment:!i.cachedVariant})]:[]}getAbTestMatches(e){const t=[];return this.abTests.forEach(i=>{const r=this.getMatchingVariant(i,e);if(r){const n=this.getCachedVariant(i);(r.config.original||n)&&t.push({optimization:i,matchingVariant:r,cachedVariant:n})}}),t}getAbTestSelections(e){const t=this.getAbTestMatches(e);if(t.length===0)return[];const i=t.find(r=>!!r.cachedVariant);if(!i&&this.hasAnyCachedVariants())return[];if(i)return[new m({optimization:i.optimization,matchingVariant:i.matchingVariant,selectedVariant:i.cachedVariant,isFirstAssignment:!1})];switch(this.distributionMethod){case"greedy":return this.getGreedySelections(t);case"even":return this.getEvenSelections(t);default:throw new Error(`Unknown distribution method: ${this.distributionMethod}`)}}isBot(){const e=navigator.userAgent,t=E(e);return console.debug("Bot testing with user agent:",e),t}handleThemeReview(){const t=new URLSearchParams(location.search).get("shgpvid");if(!t)return;if(localStorage.getItem("_shg_preview_variant_id")==t){console.debug(`shogun: theme review in progress, viewing variant: ${t}`);const a=document.getElementById("shogun-price-test-preview");if(!a){console.debug("shogun: sidebar not found!!!");return}const c=a.content.cloneNode(!0);document.addEventListener("DOMContentLoaded",()=>{document.body.style.paddingLeft="32rem",document.body.prepend(c)});return}else console.debug(`shogun: theme review in progress, setting variant: ${t}`);localStorage.setItem("_shg_preview_variant_id",t);const r=JSON.stringify({attributes:{shogun_variant_id:t}}),n=new XMLHttpRequest;n.open("POST","/cart/update.js",!0),n.setRequestHeader("Content-Type","application/json"),n.onreadystatechange=()=>{n.readyState==4&&n.status==200&&(console.debug("shogun: reloading to reflect cart pricing"),location=location)},n.send(r)}run(){if(this.isBot()){console.debug("Bot traffic detected, optimizer disabled");return}this.handleThemeReview();const e=this.getPrioritizedNonDefaultPersonalizationSelection(),t=this.getAbTestSelections(e);t.forEach(r=>{this.setCachedVariant(r.optimization,r.selectedVariant)});const i=[];if(e&&i.push(e),i.push(...t),i.push(...this.getDefaultPersonalizationSelectionsForImpressionTracking(e)),localStorage.getItem("_shg_is_merchant")||this.themeTestHandler.run(),i.length===0){console.debug("shogun: no selections to dispatch, returning");return}this.dispatcher.dispatch(i,this.currentPricingVariantId)}};o(h,"DEFAULT_NUMBER_OF_BINS",1e4),o(h,"DEFAULT_DISTRIBUTION_METHOD","greedy"),o(h,"OPTIMIZATIONS_CACHE_KEY","_shg_ab_optimizations_cache"),o(h,"SHOPIFY_SESSION_COOKIE","_shopify_s");let V=h;window.ShogunOptimizer=V})();

</script>

{%- assign shogun_variant_id = cart.attributes.shogun_variant_id -%}
{%- if shogun_variant_id != nil -%}
  {%- assign price_tests = shop.metafields.app--214825828353.price-tests -%}
  {%- assign optimization_config = nil -%}
  {% for optimization in shop.metafields.app--214825828353.price-tests.value %}
    {% for variants in optimization.variants %}
      {% if variants.id == shogun_variant_id %}
        {% assign optimization_config = optimization %}
      {% endif %}
    {% endfor %}
  {% endfor %}

  {%- assign default_price_change = 0 -%}
  {%- assign image_size = 40 -%}
  {%- assign arrow_symbol = '<svg xmlns="http://www.w3.org/2000/svg" width="10" height="12" viewBox="0 0 10 12" fill="none"><path d="M4.92296 10.5227C4.55973 10.8482 4.55973 11.3758 4.92296 11.7012C5.28619 12.0267 5.8751 12.0267 6.23833 11.7012L9.33869 8.92346C9.70192 8.59802 9.70192 8.07038 9.33869 7.74494L6.23833 4.96717C5.8751 4.64173 5.28619 4.64173 4.92296 4.96717C4.55973 5.2926 4.55973 5.82024 4.92296 6.14568L6.43552 7.50087L4.65054 7.50087C3.10948 7.50087 1.86021 6.38158 1.86021 5.00087L1.86021 0.834201C1.86021 0.373964 1.44379 0.000867717 0.930106 0.000867762C0.416423 0.000867807 -4.79388e-07 0.373964 -4.39152e-07 0.834201L-6.07103e-07 5.00087C-4.05927e-07 7.30205 2.08212 9.16753 4.65054 9.16753L6.43552 9.16753L4.92296 10.5227Z" fill="#4A4A4A"/></svg>' -%}
  {%- assign caret_symbol = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.23966 11.7996C6.5432 12.0814 7.01775 12.0639 7.2996 11.7603L10 8.85221L12.7004 11.7603C12.9823 12.0639 13.4568 12.0814 13.7603 11.7996C14.0639 11.5177 14.0815 11.0432 13.7996 10.7397L10.5496 7.23966C10.4077 7.08683 10.2086 7 10 7C9.79145 7 9.59232 7.08683 9.45041 7.23966L6.20041 10.7397C5.91856 11.0432 5.93613 11.5177 6.23966 11.7996Z" fill="#4A4A4A"/></svg>' -%}

  {% if optimization_config and optimization_config.status == "draft" %}
    <template id="shogun-price-test-preview">
      <style>
        .shogun-price-test-preview-sidebar {
          position: fixed;
          width: 32rem;
          top: 0;
          background-color: white;
          height: 100%;
          left: 0;
          padding: 1rem;
          line-height: 2rem;
          overflow-y: auto;
        }

        .shogun-price-test-preview-sidebar-header {
          border-radius: 12px;
          border: 1px solid #e5e7eb;
          font-size: 1.25rem;
          box-shadow: rgb(181, 181, 181) 0px -1px 0px 0px inset, rgba(0, 0, 0, 0.1) 0px 0px 0px 1px inset, rgb(255, 255, 255) 0px 0.5px 0px 1.5px inset;
        }

        .shogun-price-test-preview-sidebar-title {
          border-radius: 12px 12px 0 0;
          background-color: #bfe1ff;
          padding: 1.5rem;
          font-weight: 650;
          color: black;
        }

        .shogun-price-test-preview-sidebar-content {
          padding: 1rem;
          padding-top: 0.5rem;
          border-radius: 0 0 12px 12px;
          font-size: 1.25rem;
        }

        .shogun-price-test-preview-sidebar-contact-support-button {
          margin-top: 0.8rem;
          background: #FFFFFF;
          border-radius: 0.8rem;
          padding: 6px 12px;
          border: 1px solid #e5e7eb;
          cursor: pointer;
          box-shadow: rgb(181, 181, 181) 0px -1px 0px 0px inset, rgba(0, 0, 0, 0.1) 0px 0px 0px 1px inset, rgb(255, 255, 255) 0px 0.5px 0px 1.5px inset;

          &:hover {
            background: #fafafa;
          }
        }

        .shogun-price-test-preview-sidebar-product-collection-container {
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: flex-start;
          margin-top: 1.5rem;
          gap: 0.5rem;
        }

        .shogun-price-test-preview-sidebar-product-collection-header {
          display: flex;
          flex-direction: row;
          align-items: center;
          justify-content: space-between;
          width: 100%;
          padding: 0.5rem 0;
          gap: 0.8rem;
        }

        .shogun-price-test-preview-sidebar-product-collection-header-child {
          display: flex;
          flex-direction: row;
          align-items: center;
          gap: 0.75rem;
        }

        .shogun-price-test-preview-sidebar-image-container {
          flex: none;
          box-shadow: inset 0px 0px 0px 1px rgba(0, 0, 0, 0.08);
          border-radius: 0.5rem;

          img {
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            vertical-align: middle;
          }
        }

        .shogun-price-test-preview-sidebar-title-container {
          flex: 1;
          font-size: 1rem;
          font-weight: 550;

          span {
            vertical-align: middle;
          }
        }
        
        .shogun-price-test-preview-sidebar-product-collection-item-container {
          width: 100%;
        }

        .shogun-price-test-preview-sidebar-product-collection-caret {
          background: none;
          border: none;
          cursor: pointer;
          padding: 0;
          height: 2rem;
          font-size: 1rem;
          color: #6b7280;
          transition: transform 0.3s ease-in-out;

          &:hover {
            color: #374151;
          }

          &.collapsed {
            transform: rotate(180deg);
          }
        }

        .shogun-price-test-preview-sidebar-collection-badge {
          padding: 0.20rem 0.8rem;
          border-radius: 1rem;
          font-size: 1rem;
          font-weight: 550;
          color: #00527C;
          background-color: #E0F0FF;
          line-height: 1.5rem;
        }

        .shogun-price-test-preview-sidebar-count-badge {
          color: #5700D1;
          background: #F8F7FF;
          border: 1px solid #5700D1;
          border-radius: 0.5rem;
          padding: 0.20rem 0.8rem;
          font-size: 1rem;
          line-height: 1.5rem;
          font-weight: 550;
        }

        .shogun-price-test-preview-sidebar-product-collection-children {
          margin-left: 1.5rem;
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
          overflow: hidden;
          transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out;
          max-height: 1000px;
          opacity: 1;

          &.collapsed {
            max-height: 0;
            opacity: 0;
          }
        }

        .shogun-price-test-preview-sidebar-product-collection-child-item {
          display: flex;
          flex-direction: row;
          align-items: center;
          gap: 0.8rem;
          padding: 0.25rem 0;
          justify-content: space-between;
        }

        .shogun-price-test-preview-sidebar-product-collection-child-arrow {
          color: #6b7280;
          font-size: 0.875rem;
          width: 1rem;
          text-align: center;
        }

        .shogun-price-test-preview-sidebar-product-collection-child-pricing {
          font-size: 0.875rem;
          font-weight: 500;
          color: #374151;
          display: flex;
          gap: 0.5rem;
        }

        .shogun-price-test-preview-sidebar-product-collection-child-pricing > div {
          display: inline-block;
        }

        .shogun-price-test-preview-sidebar-product-collection-child-main-content {
          display: flex;
          justify-content: flex-start;
          gap: 0.5rem;
          align-items: center;
        }
      </style>  
      <div class="shogun-price-test-preview-sidebar">
        <div class="shogun-price-test-preview-sidebar-header">
          <div class="shogun-price-test-preview-sidebar-title">
            Check the updated theme for errors
          </div>
          <div class="shogun-price-test-preview-sidebar-content">
            <span>
              We have created a variant theme with your chosen price changes. Please check everywhere your prices may appear such as product pages, collection pages, and featured product elements. If something is wrong please let us know.
            </span>
            <br>
            <button class="shogun-price-test-preview-sidebar-contact-support-button" onclick="contactSupport()">Contact support</button>
          </div>
        </div>
        <div class="shogun-price-test-preview-sidebar-product-collection-container">
          {% for collection_config in optimization_config.collections -%}
            {%- assign collection = collections[collection_config.handle] -%}
            {% if collection != nil %}
              <div class="shogun-price-test-preview-sidebar-product-collection-item-container">
                <div class="shogun-price-test-preview-sidebar-product-collection-header">
                  <div class="shogun-price-test-preview-sidebar-product-collection-header-child">
                    <div class="shogun-price-test-preview-sidebar-image-container">
                      <img src="{{ collection.featured_image | image_url: width: image_size }}" width="{{ image_size }}" height="{{ image_size }}"/>
                    </div>
                    <div class="shogun-price-test-preview-sidebar-title-container">
                      <span>{{ collection.title }}</span>
                    </div>
                    <button class="shogun-price-test-preview-sidebar-product-collection-caret collapsed" onclick="toggleCollection('collection-{{ forloop.index }}')">
                      {{ caret_symbol }}
                    </button>
                    <div class="shogun-price-test-preview-sidebar-collection-badge">
                      Collection
                    </div>
                  </div>
                  <div class="shogun-price-test-preview-sidebar-product-collection-header-child">
                    <div class="shogun-price-test-preview-sidebar-count-badge">
                      {{ collection.products.size }}
                    </div>
                  </div>
                </div>
                <div class="shogun-price-test-preview-sidebar-product-collection-children collapsed" id="collection-{{ forloop.index }}">
                  {% for product in collection.products %}
                    {% if product.title != blank and product.variants.size > 0 %}
                      <div class="shogun-price-test-preview-sidebar-product-collection-child-item shogun-price-test-preview-sidebar-product-collection-child-item-flex">
                        <div class="shogun-price-test-preview-sidebar-product-collection-child-main-content">
                          <div class="shogun-price-test-preview-sidebar-product-collection-child-arrow">
                            {{ arrow_symbol }}
                          </div>
                          <div class="shogun-price-test-preview-sidebar-image-container">
                            <img src="{{ product.featured_image | image_url: width: image_size }}" width="{{ image_size }}" height="{{ image_size }}"/>
                          </div>
                          <div class="shogun-price-test-preview-sidebar-title-container">
                            <span>{{ product.title }}</span>
                          </div>
                          {% if product.variants.size > 1 %}
                          <button class="shogun-price-test-preview-sidebar-product-collection-caret collapsed" onclick="toggleProduct('collection-{{ forloop.parentloop.index }}-product-{{ forloop.index }}')">
                            {{ caret_symbol }}
                          </button>
                          {% endif %}
                        </div>
                        {% if product.variants.size > 1 %}
                        <div class="shogun-price-test-preview-sidebar-count-badge">
                          {{ product.variants.size }}
                        </div>
                        {% endif %}
                        {% if product.variants.size == 1 %}
                          <div class="shogun-price-test-preview-sidebar-product-collection-child-pricing">
                            {%- assign original_price = 0 -%}
                            {%- assign new_price = 0 -%}
                            {%- assign price_change = 0 -%}
                            {% for product_config in optimization_config.products %}
                              {% if product_config.handle == product.handle %}
                                {%- assign original_price = product_config.variant_pricing.first.original_price -%}
                                {%- assign new_price = product_config.variant_pricing.first.test_price -%}
                                {%- assign price_change = product_config.variant_pricing.first.price_change -%}
                              {% endif %}
                            {% endfor %}
                            <div>${{ original_price }}</div>
                            <div>{{ price_change }}%</div>
                            <div>${{ new_price }}</div>
                          </div>
                        {% endif %}
                      </div>
                      {% if product.variants.size > 1 %}
                        <div class="shogun-price-test-preview-sidebar-product-collection-children collapsed" id="collection-{{ forloop.parentloop.index }}-product-{{ forloop.index }}">
                          {% for variant in product.variants %}
                            <div class="shogun-price-test-preview-sidebar-product-collection-child-item">
                              <div class="shogun-price-test-preview-sidebar-product-collection-child-arrow">
                                {{ arrow_symbol }}
                              </div>
                              <div class="shogun-price-test-preview-sidebar-image-container">
                                <img src="{{ variant.featured_image | default: product.featured_image | image_url: width: image_size }}" width="{{ image_size }}" height="{{ image_size }}"/>
                              </div>
                              <div class="shogun-price-test-preview-sidebar-title-container">
                                <span>{{ variant.title | default: product.title }}</span>
                              </div>
                              <div class="shogun-price-test-preview-sidebar-product-collection-child-pricing">
                                {%- assign original_price = 0 -%}
                                {%- assign new_price = 0 -%}
                                {%- assign price_change = 0 -%}
                                {% for product_config in optimization_config.products %}
                                  {% if product_config.handle == product.handle %}
                                    {% for variant_pricing in product_config.variant_pricing %}
                                      {% if variant_pricing.id | append: '' == variant.id | append: '' %}
                                        {%- assign original_price = variant_pricing.original_price -%}
                                        {%- assign new_price = variant_pricing.test_price -%}
                                        {%- assign price_change = variant_pricing.price_change -%}
                                      {% endif %}
                                    {% endfor %}
                                  {% endif %}
                                {% endfor %}
                                <div>${{ original_price }}</div>
                                <div>{{ price_change }}%</div>
                                <div>${{ new_price }}</div>
                              </div>
                            </div>
                          {% endfor %}
                        </div>
                      {% endif %}
                    {% endif %}
                  {% endfor %}
                </div>
              </div>
            {% endif %}
          {% endfor -%}
          {%- assign products_in_collections = '' -%}
          {% for collection_config in optimization_config.collections -%}
            {%- assign collection = collections[collection_config.handle] -%}
            {% if collection != nil %}
              {% for product in collection.products %}
                {%- assign products_in_collections = products_in_collections | append: product.handle | append: ',' -%}
              {% endfor %}
            {% endif %}
          {% endfor -%}
          {% for product_config in optimization_config.products -%}
            {%- assign product = all_products[product_config.handle] -%}
            {%- assign product_in_collection = false -%}
            {%- if products_in_collections contains product_config.handle -%}
              {%- assign product_in_collection = true -%}
            {%- endif -%}
            {% if product != nil and product_in_collection == false and product.title != blank and product.variants.size > 0 %}
              <div class="shogun-price-test-preview-sidebar-product-collection-item-container">
                <div class="shogun-price-test-preview-sidebar-product-collection-header">
                  <div class="shogun-price-test-preview-sidebar-product-collection-header-child">
                    <div class="shogun-price-test-preview-sidebar-image-container">
                      <img src="{{ product.featured_image | image_url: width: image_size }}" width="{{ image_size }}" height="{{ image_size }}"/>
                    </div>
                    <div class="shogun-price-test-preview-sidebar-title-container">
                      <span>{{ product.title }}</span>
                    </div>
                    {% if product.variants.size > 1 %}
                      <button class="shogun-price-test-preview-sidebar-product-collection-caret collapsed" onclick="toggleProduct('product-{{ forloop.index }}')">
                        {{ caret_symbol }}
                      </button>
                    {% endif %}
                    </div>
                    <div class="shogun-price-test-preview-sidebar-product-collection-header-child">
                      {% if product.variants.size > 1 %}
                        <div class="shogun-price-test-preview-sidebar-count-badge">
                          {{ product.variants.size }}
                        </div>
                      {% endif %}
                      {% if product.variants.size == 1 %}
                        <div class="shogun-price-test-preview-sidebar-product-collection-child-pricing">
                          {%- assign original_price = product_config.variant_pricing.first.original_price -%}
                          {%- assign new_price = product_config.variant_pricing.first.test_price -%}
                          {%- assign price_change = product_config.variant_pricing.first.price_change -%}
                          <div>${{ original_price }}</div>
                          <div>{{ price_change }}%</div>
                          <div>${{ new_price }}</div>
                        </div>
                      {% endif %}
                    </div>
                  </div>
                  {% if product.variants.size > 1 %}
                    <div class="shogun-price-test-preview-sidebar-product-collection-children collapsed" id="product-{{ forloop.index }}">
                      {% for variant in product.variants %}
                        <div class="shogun-price-test-preview-sidebar-product-collection-child-item">
                          <div class="shogun-price-test-preview-sidebar-product-collection-child-arrow">
                            {{ arrow_symbol }}
                          </div>
                          <div class="shogun-price-test-preview-sidebar-image-container">
                            <img src="{{ variant.featured_image | default: product.featured_image | image_url: width: image_size }}" width="{{ image_size }}" height="{{ image_size }}"/>
                          </div>
                          <div class="shogun-price-test-preview-sidebar-title-container">
                            <span>{{ variant.title | default: product.title }}</span>
                          </div>
                          <div class="shogun-price-test-preview-sidebar-product-collection-child-pricing">
                            {%- assign original_price = 0 -%}
                            {%- assign new_price = 0 -%}
                            {%- assign price_change = 0 -%}
                            {% for variant_pricing in product_config.variant_pricing %}
                              {% if variant_pricing.id | append: '' == variant.id | append: '' %}
                                {%- assign original_price = variant_pricing.original_price -%}
                                {%- assign new_price = variant_pricing.test_price -%}
                                {%- assign price_change = variant_pricing.price_change -%}
                              {% endif %}
                            {% endfor %}
                            <div>${{ original_price }}</div>
                            <div>{{ price_change }}%</div>
                            <div>${{ new_price }}</div>
                          </div>
                        </div>
                      {% endfor %}
                    </div>
                  {% endif %}
                </div>
              </div> 
            {% endif %}
          {% endfor %}
        </div> 
      </div>
    </template>
    <script>
      function toggleElement(elementId) {
        const children = document.getElementById(elementId);
        const caret = children.previousElementSibling.querySelector('.shogun-price-test-preview-sidebar-product-collection-caret');
        
        if (children.classList.contains('collapsed')) {
          // Expand: remove collapsed class first, then rotate caret
          children.classList.remove('collapsed');
          caret.classList.remove('collapsed');
        } else {
          // Collapse: add collapsed class, then rotate caret
          children.classList.add('collapsed');
          caret.classList.add('collapsed');
        }
      }
      
      function toggleCollection(collectionId) {
        toggleElement(collectionId);
      }

      function toggleProduct(productId) {
        toggleElement(productId);
      }

      function contactSupport() {
        const subject = encodeURIComponent('A/B Testing Question');
        const body = encodeURIComponent('Hi Shogun Team,\n\n');
        const mailtoLink = `mailto:support-ab@getshogun.com?subject=${subject}&body=${body}`;
        window.open(mailtoLink, '_blank');
      }
    </script>
  {% endif %}
{%- endif -%}

<script type="text/javascript">
  ;(function() {
    if (typeof ShogunOptimizer === 'undefined') {
      console.error("ShogunOptimizer is not defined. Please ensure the optimizer script is properly loaded.");
      return;
    }

    const designMode = {{ request.design_mode | default: false }};
    if (designMode) {
      console.debug("Design mode is enabled, skipping optimizer initialization");
      return;
    }

    // If the referrer url is the Shopify admin url, then set a local storage shg_is_merchant flag to true
    // This is used to remove the preview bar from the page for shoppers
    const referrer = document.referrer
    if (!localStorage.getItem('_shg_is_merchant') && ((referrer.includes('admin.shopify.com') || referrer.includes('shogun')))) {
      console.debug('Setting shg_is_merchant to true')
      localStorage.setItem('_shg_is_merchant', 'true')
    }

    const urlParams = new URLSearchParams(window.location.search);
    const optimizationDisabled = urlParams.get('shg') === "false" || window.location.hostname.includes('shopifypreview');

    if (optimizationDisabled) {
      console.debug("Optimization is disabled, skipping optimizer initialization");
      return;
    }

    const shopMetafieldConfig = {{ shop.metafields.shgabc.optimizations }} || {};
    const optimizationsData = shopMetafieldConfig.expires_at > Date.now() ? (shopMetafieldConfig.optimizations || []) : [];

    const optimizerConfig = {
      optimizations: optimizationsData,
      distributionMethod: urlParams.get('shgMethod') || shopMetafieldConfig.method,
      defaultThemeId: String(shopMetafieldConfig.default_theme_id),
      currentThemeId: "179206914416",
      pageId: "{{ content.id }}",
      pageType: "{% if article %}article{% elsif blog %}blog{% elsif page %}page{% elsif product %}product{% elsif collection %}collection{% elsif metaobject %}metaobject{% else %}homepage{% endif %}",
      templateName: "{{ template.name }}",
      templateSuffix: "{{ template.suffix }}",
      customerId: "{{ customer.id }}",
      isB2B: {{ customer.b2b? | default: false }},
      cacheEnabled: urlParams.get('cache') !== "false",
      sessionIdOverride: urlParams.get('shgSessionId'),
      geoLocationApi: "https://ipinfo.io/json?token=f2ae3a557d807b",
      currentPricingVariantId: {% if cart.attributes.shogun_variant_id %}"{{ cart.attributes.shogun_variant_id }}"{% else %}null{%  endif %},
    };

    console.debug("Initializing ShogunOptimizer with config:", optimizerConfig);
    const optimizer = new ShogunOptimizer(optimizerConfig);
    optimizer.run();
  })();
</script>
